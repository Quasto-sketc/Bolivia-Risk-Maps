<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Riesgos de Pasorapa - 3&nbsp; Flood Risk</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./references.html" rel="next">
<link href="./Frost_Risk.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./Flood_Risk.html"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Flood Risk</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Riesgos de Pasorapa</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Drought_Risk.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Drought Risk</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Frost_Risk.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Frost Risk</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Flood_Risk.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Flood Risk</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Appendix.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Appendix</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Author.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">About the Author</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#sec-sec-flood" id="toc-sec-sec-flood" class="nav-link active" data-scroll-target="#sec-sec-flood"><span class="header-section-number">3.1</span> Frame of Reference</a></li>
  <li><a href="#methodology-of-the-case-study" id="toc-methodology-of-the-case-study" class="nav-link" data-scroll-target="#methodology-of-the-case-study"><span class="header-section-number">3.2</span> Methodology of the Case Study</a>
  <ul class="collapse">
  <li><a href="#river-data" id="toc-river-data" class="nav-link" data-scroll-target="#river-data"><span class="header-section-number">3.2.1</span> River Data</a></li>
  <li><a href="#precipitation-data" id="toc-precipitation-data" class="nav-link" data-scroll-target="#precipitation-data"><span class="header-section-number">3.2.2</span> Precipitation Data</a></li>
  <li><a href="#dem-inclination-data" id="toc-dem-inclination-data" class="nav-link" data-scroll-target="#dem-inclination-data"><span class="header-section-number">3.2.3</span> DEM (Inclination) Data</a></li>
  </ul></li>
  <li><a href="#results-flood-risk" id="toc-results-flood-risk" class="nav-link" data-scroll-target="#results-flood-risk"><span class="header-section-number">3.3</span> Results Flood Risk</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Flood Risk</span></h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="sec-sec-flood" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="sec-sec-flood"><span class="header-section-number">3.1</span> Frame of Reference</h2>
<p>This research presents a low-cost and flexible methodology for mapping flood hazard and assessing resulting risk. The methodology is generic and can be customized for freely available data with global coverage, allowing for worldwide risk assessment. Region-specific information can be added to the default workflow when available.</p>
<p>Floods are a significant global hazard, posing threats to both human societies and natural ecosystems. The increase in flood occurrences is caused by the interaction between climate variations and changes in land-use patterns. These dynamics put significant stress on river systems, leading to significant changes in river morphology <span class="citation" data-cites="Hagos2022">(<a href="references.html#ref-Hagos2022" role="doc-biblioref">Hagos et al. 2022</a>)</span>.</p>
<p>This study aims to evaluate flood risk and identify inundation zones in the Valle Alto region of Cochabamba, including Aiquile, Pasorapa, Pojo, and Totoro. The genesis of floods is influenced by various factors such as soil properties, terrain slope, elevation, drainage density, and land cover characteristics. In Bolivia, some of these factors were included in the analysis framework due to limited data availability.</p>
<p>The analytic hierarchy process was used to determine the relative weights assigned to each contributing factor, incorporating insights from public institutions and expert consensus. The acquired data was processed in the R-Studio environment to construct a comprehensive flood hazard map.</p>
<p>The aim of this study is to inform evidence-based decision-making processes, ultimately enhancing the resilience of communities and ecosystems to flood-related hazards.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="sc">|</span> Source <span class="sc">|</span> Description <span class="sc">|</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="er">|</span> <span class="sc">------</span> <span class="er">|</span> <span class="sc">-----------</span> <span class="er">|</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="er">|</span> [Applied Water Science](https<span class="sc">:</span><span class="er">//</span>link.springer.com<span class="sc">/</span>article<span class="sc">/</span><span class="fl">10.1007</span><span class="sc">/</span>s13201<span class="dv">-022-01674-8</span>) <span class="sc">|</span> Study on <span class="st">"Flood hazard assessment and mapping using GIS integrated with multi-criteria decision analysis in upper Awash River basin, Ethiopia"</span>. <span class="sc">|</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="er">|</span> [MDPI](https<span class="sc">:</span><span class="er">//</span>www.mdpi.com<span class="sc">/</span><span class="dv">2073-4441</span><span class="sc">/</span><span class="dv">11</span><span class="sc">/</span><span class="dv">11</span><span class="sc">/</span><span class="dv">2371</span><span class="sc">/</span>htm) <span class="sc">|</span> Flexible methodology and toolbox <span class="cf">for</span> flood risk mapping worldwide. <span class="sc">|</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="er">|</span> [Sustainability](https<span class="sc">:</span><span class="er">//</span>www.mdpi.com<span class="sc">/</span><span class="dv">2071-1050</span><span class="sc">/</span><span class="dv">14</span><span class="sc">/</span><span class="dv">8</span><span class="sc">/</span><span class="dv">4483</span>) <span class="sc">|</span> Study on <span class="st">"Urban Flood-Risk Assessment and Management Using Integrated Multi-Parameter Decision-Making Approach and Geospatial Techniques"</span>. <span class="sc">|</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="er">|</span> [Springer](https<span class="sc">:</span><span class="er">//</span>link.springer.com<span class="sc">/</span>referenceworkentry<span class="sc">/</span><span class="fl">10.1007</span><span class="sc">/</span><span class="dv">978-981-16-8800</span><span class="sc">-</span>3_177<span class="dv">-1</span>) <span class="sc">|</span> Risk Mapping <span class="cf">in</span> Managing Flood Vulnerability <span class="cf">in</span> Disaster Management. <span class="sc">|</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="er">|</span> [MDPI](https<span class="sc">:</span><span class="er">//</span>www.mdpi.com<span class="sc">/</span><span class="dv">2071-1050</span><span class="sc">/</span><span class="dv">14</span><span class="sc">/</span><span class="dv">6</span><span class="sc">/</span><span class="dv">3251</span>) <span class="sc">|</span> Flood Hazard and Risk Mapping by Applying an Explainable Machine Learning Framework Using Satellite Imagery and GIS Data. <span class="sc">|</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="er">|</span> [MDPI](https<span class="sc">:</span><span class="er">//</span>www.mdpi.com<span class="sc">/</span><span class="dv">2073-4441</span><span class="sc">/</span><span class="dv">11</span><span class="sc">/</span><span class="dv">11</span><span class="sc">/</span><span class="dv">2371</span>) <span class="sc">|</span> Flood Risk Mapping Worldwide<span class="sc">:</span> A Flexible Methodology and Toolbox. <span class="sc">|</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># read libraries</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(raster)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(terra)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tmap)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tibble)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># read data</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>bol   <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(<span class="st">"gadm41_BOL_3.shp"</span>, <span class="at">crs =</span> <span class="dv">4326</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>cocha <span class="ot">&lt;-</span> bol <span class="sc">%&gt;%</span> <span class="fu">filter</span>(NAME_1 <span class="sc">==</span> <span class="st">"Cochabamba"</span>)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>Pasorapa <span class="ot">&lt;-</span> cocha <span class="sc">%&gt;%</span> <span class="fu">filter</span>(NAME_3 <span class="sc">==</span> <span class="st">"Pasorapa"</span>)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>Aiquile  <span class="ot">&lt;-</span> cocha <span class="sc">%&gt;%</span> <span class="fu">filter</span>(NAME_3 <span class="sc">==</span> <span class="st">"Aiquile"</span>)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="co"># new</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>totora   <span class="ot">&lt;-</span> cocha <span class="sc">%&gt;%</span> <span class="fu">filter</span>(NAME_3 <span class="sc">==</span> <span class="st">"Totora"</span>)</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>pojo     <span class="ot">&lt;-</span> cocha <span class="sc">%&gt;%</span> <span class="fu">filter</span>(NAME_3 <span class="sc">==</span> <span class="st">"Pojo"</span>)</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="co"># set extent</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>all_municipalities <span class="ot">&lt;-</span> <span class="fu">rbind</span>(Pasorapa, Aiquile, totora, pojo)</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="co"># read dm-raster</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>dem <span class="ot">&lt;-</span> <span class="fu">rast</span>(<span class="st">"s20w070_dem.tif"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="methodology-of-the-case-study" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="methodology-of-the-case-study"><span class="header-section-number">3.2</span> Methodology of the Case Study</h2>
<p>In order to conduct this Multicriteria Analysis, a comparable approach to <span class="citation" data-cites="Hagos2022">Hagos et al. (<a href="references.html#ref-Hagos2022" role="doc-biblioref">2022</a>)</span> has been undertaken. The analysis employs numerous raster and vector layers, integrating weighted factors. The entire project is conducted within the R-Studio environment. Key packages utilized in achieving the final results are listed in <a href="Appendix.html#sec-sec-libraries">R-Studio Libraries</a>, providing essential functions for the conducted calculations. The following data has been used.</p>
<p><a href="#tbl-data-Pasorapa">Table&nbsp;<span>3.1</span></a> shows the data used in order to conduct the Multicriteria Analysis on the four municipalities in the Cono Sur Region in Cochabamba, Bolivia.</p>
<p><a href="#tbl-data-weights-def">Table&nbsp;<span>3.2</span></a> presents the classification and evaluation of various criteria for drought exposure, illustrating the factors influencing each classification. This table outlines the criteria and their corresponding classifications as follows.</p>
<p>The subsequent sections present the reclassified data for four municipalities in the state of Cochabamba. These sections detail the process of cleaning and further processing the raw data, with relevant code snippets linked to the Appendix for reference.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating a table</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>shapes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Political Map"</span>, <span class="st">"River Data"</span>, <span class="st">"Precipitation"</span>, <span class="st">"DEM (Inclination)"</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>data_type <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Vector"</span>, <span class="st">"Vector"</span>, <span class="st">"Raster (30 s)"</span>, <span class="st">"Raster (15 s)"</span>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>sources <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"[gadm.org](https://gadm.org/download_country.html)"</span>,</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">"@linke2019global"</span>,</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">"@fick2017worldclim"</span>, </span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">"[Hydrosheds.org](https://www.hydrosheds.org/hydrosheds-core-downloads)"</span>)</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>period <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"2024"</span>, <span class="st">"2013"</span>, <span class="st">"1970-2000"</span>, <span class="st">"2013"</span>)</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Repeat the sources based on the number of shapes</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>repeated_sources <span class="ot">&lt;-</span> <span class="fu">rep</span>(sources, <span class="at">length.out =</span> <span class="fu">length</span>(shapes))</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the data frame</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Data =</span> shapes, <span class="at">Types =</span> data_type, <span class="at">Source =</span> repeated_sources, <span class="at">Period_Year =</span> period)</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(data) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Data"</span>, <span class="st">"Types"</span>, <span class="st">"Source"</span>, <span class="st">"Period/Year"</span>)</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="tbl-data-Pasorapa" class="anchored">
<table class="table table-sm table-striped small">
<caption>Table&nbsp;3.1: Used Data in the Analysis</caption>
<colgroup>
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Data</th>
<th style="text-align: left;">Types</th>
<th style="text-align: left;">Source</th>
<th style="text-align: left;">Period/Year</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Political Map</td>
<td style="text-align: left;">Vector</td>
<td style="text-align: left;"><a href="https://gadm.org/download_country.html">gadm.org</a></td>
<td style="text-align: left;">2024</td>
</tr>
<tr class="even">
<td style="text-align: left;">River Data</td>
<td style="text-align: left;">Vector</td>
<td style="text-align: left;"><span class="citation" data-cites="linke2019global">Linke et al. (<a href="references.html#ref-linke2019global" role="doc-biblioref">2019</a>)</span></td>
<td style="text-align: left;">2013</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Precipitation</td>
<td style="text-align: left;">Raster (30 s)</td>
<td style="text-align: left;"><span class="citation" data-cites="fick2017worldclim">Fick and Hijmans (<a href="references.html#ref-fick2017worldclim" role="doc-biblioref">2017</a>)</span></td>
<td style="text-align: left;">1970-2000</td>
</tr>
<tr class="even">
<td style="text-align: left;">DEM (Inclination)</td>
<td style="text-align: left;">Raster (15 s)</td>
<td style="text-align: left;"><a href="https://www.hydrosheds.org/hydrosheds-core-downloads">Hydrosheds.org</a></td>
<td style="text-align: left;">2013</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating a sample data frame</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Criteria =</span> <span class="fu">c</span>(<span class="st">"River Data"</span>, <span class="st">"Precipitation"</span>, <span class="st">"DEM (Inclination)"</span>),</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">Very High</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"&lt;200"</span>, <span class="st">"&gt;1058"</span>, <span class="st">"&lt;10"</span>),</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">High        =</span> <span class="fu">c</span>(<span class="st">"200-700"</span>, <span class="st">"640-1058"</span>, <span class="st">"10-20"</span>),</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">Moderate    =</span> <span class="fu">c</span>(<span class="st">"700-2000"</span>, <span class="st">"571-640"</span>, <span class="st">"20-30"</span>),</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">Low         =</span> <span class="fu">c</span>(<span class="st">"2000-5000"</span>, <span class="st">"514-571"</span>, <span class="st">"30-45"</span>),</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">Very Low</span><span class="st">`</span>  <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"&gt;5000"</span>, <span class="st">"&lt;513.8"</span>, <span class="st">"&gt;45"</span>),</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">Weights</span><span class="st">`</span>   <span class="ot">=</span> <span class="fu">c</span>(<span class="fl">2.5</span>, <span class="dv">4</span>, <span class="fl">3.5</span>)</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualizing the table with kable</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(data, <span class="at">align =</span> <span class="st">"c"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="tbl-data-weights-def" class="anchored">
<table class="table table-sm table-striped small">
<caption>Table&nbsp;3.2: Classiﬁcation and evaluation of drought exposure according to factors</caption>
<colgroup>
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">Criteria</th>
<th style="text-align: center;">Very.High</th>
<th style="text-align: center;">High</th>
<th style="text-align: center;">Moderate</th>
<th style="text-align: center;">Low</th>
<th style="text-align: center;">Very.Low</th>
<th style="text-align: center;">Weights</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">River Data</td>
<td style="text-align: center;">&lt;200</td>
<td style="text-align: center;">200-700</td>
<td style="text-align: center;">700-2000</td>
<td style="text-align: center;">2000-5000</td>
<td style="text-align: center;">&gt;5000</td>
<td style="text-align: center;">2.5</td>
</tr>
<tr class="even">
<td style="text-align: center;">Precipitation</td>
<td style="text-align: center;">&gt;1058</td>
<td style="text-align: center;">640-1058</td>
<td style="text-align: center;">571-640</td>
<td style="text-align: center;">514-571</td>
<td style="text-align: center;">&lt;513.8</td>
<td style="text-align: center;">4.0</td>
</tr>
<tr class="odd">
<td style="text-align: center;">DEM (Inclination)</td>
<td style="text-align: center;">&lt;10</td>
<td style="text-align: center;">10-20</td>
<td style="text-align: center;">20-30</td>
<td style="text-align: center;">30-45</td>
<td style="text-align: center;">&gt;45</td>
<td style="text-align: center;">3.5</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read data and crop to Pasorapa</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co"># read data </span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="do">## shapes</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co"># veg   &lt;- read_sf("veg_nv_bol_geo.shp") # Vegetation</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="co"># geo   &lt;- read_sf("Geologia.shp") # Geografia</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="co"># geo   &lt;- read_sf("geologia.shp", crs = 4326)   # Geografia</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="co"># dsmw  &lt;- read_sf("DSMW.shp", crs = 4326)</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="co"># other kind of vegetation</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="co"># se_bo_geo &lt;- read_sf("se_bo_geo.shp")</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="co"># temperatur min</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="co"># tmin01 &lt;- rast("wc2.1_30s_tmin_01.tif")</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="co"># tmin02 &lt;- rast("wc2.1_30s_tmin_02.tif")</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a><span class="co"># tmin03 &lt;- rast("wc2.1_30s_tmin_03.tif")</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a><span class="co"># tmin04 &lt;- rast("wc2.1_30s_tmin_04.tif")</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a><span class="co"># tmin05 &lt;- rast("wc2.1_30s_tmin_05.tif")</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a><span class="co"># tmin06 &lt;- rast("wc2.1_30s_tmin_06.tif")</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a><span class="co"># tmin07 &lt;- rast("wc2.1_30s_tmin_07.tif")</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a><span class="co"># tmin08 &lt;- rast("wc2.1_30s_tmin_08.tif")</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a><span class="co"># tmin09 &lt;- rast("wc2.1_30s_tmin_09.tif")</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a><span class="co"># tmin10 &lt;- rast("wc2.1_30s_tmin_10.tif")</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a><span class="co"># tmin11 &lt;- rast("wc2.1_30s_tmin_11.tif")</span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a><span class="co"># tmin12 &lt;- rast("wc2.1_30s_tmin_12.tif")</span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a><span class="co"># temperatur max</span></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a><span class="co"># tmax01 &lt;- rast("wc2.1_30s_tmax_01.tif")</span></span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a><span class="co"># tmax02 &lt;- rast("wc2.1_30s_tmax_02.tif")</span></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a><span class="co"># tmax03 &lt;- rast("wc2.1_30s_tmax_03.tif")</span></span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a><span class="co"># tmax04 &lt;- rast("wc2.1_30s_tmax_04.tif")</span></span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a><span class="co"># tmax05 &lt;- rast("wc2.1_30s_tmax_05.tif")</span></span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a><span class="co"># tmax06 &lt;- rast("wc2.1_30s_tmax_06.tif")</span></span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a><span class="co"># tmax07 &lt;- rast("wc2.1_30s_tmax_07.tif")</span></span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a><span class="co"># tmax08 &lt;- rast("wc2.1_30s_tmax_08.tif")</span></span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a><span class="co"># tmax09 &lt;- rast("wc2.1_30s_tmax_09.tif")</span></span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a><span class="co"># tmax10 &lt;- rast("wc2.1_30s_tmax_10.tif")</span></span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a><span class="co"># tmax11 &lt;- rast("wc2.1_30s_tmax_11.tif")</span></span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a><span class="co"># tmax12 &lt;- rast("wc2.1_30s_tmax_12.tif")</span></span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a><span class="co"># precipitacion</span></span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a><span class="co"># precip01 &lt;- rast("wc2.1_30s_prec_01.tif")</span></span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a><span class="co"># precip02 &lt;- rast("wc2.1_30s_prec_02.tif")</span></span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a><span class="co"># precip03 &lt;- rast("wc2.1_30s_prec_03.tif")</span></span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a><span class="co"># precip04 &lt;- rast("wc2.1_30s_prec_04.tif")</span></span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a><span class="co"># precip05 &lt;- rast("wc2.1_30s_prec_05.tif")</span></span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a><span class="co"># precip06 &lt;- rast("wc2.1_30s_prec_06.tif")</span></span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a><span class="co"># precip07 &lt;- rast("wc2.1_30s_prec_07.tif")</span></span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a><span class="co"># precip08 &lt;- rast("wc2.1_30s_prec_08.tif")</span></span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a><span class="co"># precip09 &lt;- rast("wc2.1_30s_prec_09.tif")</span></span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a><span class="co"># precip10 &lt;- rast("wc2.1_30s_prec_10.tif")</span></span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a><span class="co"># precip11 &lt;- rast("wc2.1_30s_prec_11.tif")</span></span>
<span id="cb6-53"><a href="#cb6-53" aria-hidden="true" tabindex="-1"></a><span class="co"># precip12 &lt;- rast("wc2.1_30s_prec_12.tif")</span></span>
<span id="cb6-54"><a href="#cb6-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-55"><a href="#cb6-55" aria-hidden="true" tabindex="-1"></a><span class="do">## Satellite Data</span></span>
<span id="cb6-56"><a href="#cb6-56" aria-hidden="true" tabindex="-1"></a><span class="co"># sat_full &lt;- rast("sat_full.tiff")</span></span>
<span id="cb6-57"><a href="#cb6-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-58"><a href="#cb6-58" aria-hidden="true" tabindex="-1"></a><span class="co"># Land Use</span></span>
<span id="cb6-59"><a href="#cb6-59" aria-hidden="true" tabindex="-1"></a><span class="co"># land &lt;- rast("Change_10S_070W.tif")</span></span>
<span id="cb6-60"><a href="#cb6-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-61"><a href="#cb6-61" aria-hidden="true" tabindex="-1"></a><span class="co"># print(land, vp = grid::viewport(0.8, 0.185, width = 0.2, height = 0.45))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># River Data</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="do">##  200 meters Buffer River data</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>buffer_river <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_buffer</span>(Pasorapa, <span class="dv">200</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="river-data" class="level3" data-number="3.2.1">
<h3 data-number="3.2.1" class="anchored" data-anchor-id="river-data"><span class="header-section-number">3.2.1</span> River Data</h3>
<p>The data utilized aimed to estimate the distance to rivers, serving as a proxy for assessing the likelihood of drought occurrences. The underlying assumption was that greater distances from rivers correspond to increased drought probabilities. To calculate distances, the <strong><code>terra::distance</code></strong> function was employed on the river shapefiles associated with various municipalities. Detailed processing steps are outlined in the subsequent chapter of the <a href="Appendix.html#sec-sec-river">Appendix</a>.</p>
<p>The reclassification has been calculated according to <a href="#tbl-data-weights-def">Table&nbsp;<span>3.2</span></a>. Defining the classification values <span class="citation" data-cites="Gao2023">Gao et al. (<a href="references.html#ref-Gao2023" role="doc-biblioref">2023</a>)</span> has been using different values in order to classify and evaluate drought exposure, hazard factors, vulnerability, and mitigation capacity.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>river_crop <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(<span class="st">"river_crop.shp"</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>buffer_river <span class="ot">&lt;-</span> <span class="fu">st_buffer</span>(river_crop, <span class="dv">100</span>)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Create an empty raster to rasterize into</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>empty_raster <span class="ot">&lt;-</span> <span class="fu">raster</span>(<span class="fu">extent</span>(buffer_river), <span class="at">resolution =</span> <span class="fu">c</span>(<span class="fl">0.0008333333</span>, <span class="fl">0.0008333333</span>))</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Rasterize</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>river_raster <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rasterize</span>(buffer_river, empty_raster, <span class="at">field =</span> <span class="st">"CATCH_SKM"</span>)</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="co"># , background = 0</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calc into %</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>river_raster <span class="ot">&lt;-</span> (river_raster <span class="sc">/</span> <span class="dv">100</span>)</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a><span class="co"># River</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a><span class="do">##  crop and mask dem</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>river_crop <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">crop</span>(river_raster, Pasorapa)</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>river_mask <span class="ot">&lt;-</span> <span class="fu">mask</span>(river_crop, Pasorapa)</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a><span class="co"># plot(river_mask)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define a common CRS for all your rasters</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>common_crs <span class="ot">&lt;-</span> <span class="st">"+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0"</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Assign the CRS to each raster</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="fu">crs</span>(river_raster) <span class="ot">&lt;-</span> <span class="fu">crs</span>(river_subset_sp) <span class="ot">&lt;-</span> common_crs</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate distances on the subset</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>dist_to_river <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">distance</span>(river_mask)</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="co"># writeRaster(dist_to_river, "dist_to_river_pasorapa.tif")</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>dist_to_river <span class="ot">&lt;-</span> <span class="fu">rast</span>(<span class="st">"dist_to_river_pasorapa.tif"</span>)</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the distances raster</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dist_to_river)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define areas of interest</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>areas <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">pasorapa =</span> Pasorapa,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">aiquile =</span> Aiquile,</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">totora =</span> totora,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">pojo =</span> pojo</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Define river distance raster files</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>river_rasters <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">pasorapa =</span> <span class="st">"dist_to_river_pasorapa.tif"</span>,</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">aiquile  =</span> <span class="st">"dist_to_river_aiquile.tif"</span>,</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">totora   =</span> <span class="st">"dist_to_river_totora.tif"</span>,</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">pojo     =</span> <span class="st">"dist_to_river_pojo.tif"</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a><span class="co"># reclass</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a tibble with the reclassification table</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>reclass_table_river <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span>from, <span class="sc">~</span>to, <span class="sc">~</span>becomes,</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>  <span class="dv">5000</span>,    <span class="cn">Inf</span>,  <span class="dv">0</span>,     </span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>  <span class="dv">2000</span>,    <span class="dv">5000</span>,  <span class="fl">0.25</span>,  </span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>  <span class="dv">700</span>,    <span class="dv">2000</span>,  <span class="fl">0.5</span>,    </span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>  <span class="dv">200</span>,    <span class="dv">700</span>,  <span class="fl">0.75</span>,   </span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>  <span class="sc">-</span><span class="cn">Inf</span>,   <span class="dv">200</span>,  <span class="dv">1</span>       </span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Common CRS for all rasters</span></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>common_crs <span class="ot">&lt;-</span> <span class="st">"+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0"</span></span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop through areas of interest</span></span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (area_name <span class="cf">in</span> <span class="fu">names</span>(areas)) {</span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Load river distance raster</span></span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>  dist_to_river <span class="ot">&lt;-</span> <span class="fu">rast</span>(river_rasters[[area_name]])</span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Assign common CRS</span></span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">crs</span>(dist_to_river) <span class="ot">&lt;-</span> common_crs</span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_crs</span>(areas[[area_name]]) <span class="ot">&lt;-</span> common_crs</span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Crop and mask river distance raster</span></span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a>  river_crop <span class="ot">&lt;-</span> <span class="fu">crop</span>(dist_to_river, areas[[area_name]])</span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a>  river_mask <span class="ot">&lt;-</span> <span class="fu">mask</span>(river_crop, areas[[area_name]])</span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-44"><a href="#cb10-44" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Reclassify the river distance raster</span></span>
<span id="cb10-45"><a href="#cb10-45" aria-hidden="true" tabindex="-1"></a>  river_reclassified <span class="ot">&lt;-</span> <span class="fu">classify</span>(river_mask, reclass_table_river, <span class="at">include.lowest =</span> <span class="cn">TRUE</span>, <span class="at">right =</span> <span class="cn">TRUE</span>)</span>
<span id="cb10-46"><a href="#cb10-46" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-47"><a href="#cb10-47" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Assign to appropriate variable</span></span>
<span id="cb10-48"><a href="#cb10-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(<span class="fu">paste0</span>(<span class="st">"river_reclassified_"</span>, area_name), river_reclassified)</span>
<span id="cb10-49"><a href="#cb10-49" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># write / safe Raster</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="co"># writeRaster(dist_to_river, "dist_to_river_pasorapa.tif")</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>dist_to_river <span class="ot">&lt;-</span> <span class="fu">rast</span>(<span class="st">"dist_to_river_pasorapa.tif"</span>)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="co"># River</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="do">##  crop and mask dem</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>river_crop <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">crop</span>(dist_to_river, Pasorapa)</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>river_mask <span class="ot">&lt;-</span> <span class="fu">mask</span>(river_crop, Pasorapa)</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="co"># reclass</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a tibble with the reclassification table</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>reclass_table_river <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span>from, <span class="sc">~</span>to, <span class="sc">~</span>becomes,</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>  <span class="dv">5000</span>,    <span class="cn">Inf</span>,  <span class="dv">0</span>,     </span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>  <span class="dv">2000</span>,    <span class="dv">5000</span>,  <span class="fl">0.25</span>,  </span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>  <span class="dv">700</span>,    <span class="dv">2000</span>,  <span class="fl">0.5</span>,    </span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>  <span class="dv">200</span>,    <span class="dv">700</span>,  <span class="fl">0.75</span>,   </span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>  <span class="sc">-</span><span class="cn">Inf</span>,   <span class="dv">200</span>,  <span class="dv">1</span>       </span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Reclassify the slope raster based on the reclassification table</span></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>river_reclassified_pasorapa <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">classify</span>(river_mask, reclass_table_river, <span class="at">include.lowest =</span> <span class="cn">TRUE</span>, <span class="at">right =</span> <span class="cn">TRUE</span>)</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a><span class="co"># kable(reclass_table_river)</span></span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a><span class="co"># write/ safe Raster</span></span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>dist_to_river <span class="ot">&lt;-</span> <span class="fu">rast</span>(<span class="st">"dist_to_river_aiquile.tif"</span>)</span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>common_crs <span class="ot">&lt;-</span> <span class="st">"+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0"</span></span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Assign the CRS to each raster</span></span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a><span class="fu">crs</span>(dist_to_river) <span class="ot">&lt;-</span> common_crs</span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(Aiquile)    <span class="ot">&lt;-</span> common_crs</span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a><span class="co"># River</span></span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a><span class="do">##  crop and mask dem</span></span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a>river_crop <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">crop</span>(dist_to_river, Aiquile)</span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a>river_mask <span class="ot">&lt;-</span> <span class="fu">mask</span>(river_crop, Aiquile)</span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Reclassify the slope raster based on the reclassification table</span></span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a>river_reclassified_aiquile <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">classify</span>(river_mask, reclass_table_river, <span class="at">include.lowest =</span> <span class="cn">TRUE</span>, <span class="at">right =</span> <span class="cn">TRUE</span>)</span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true" tabindex="-1"></a><span class="co"># pojo</span></span>
<span id="cb11-44"><a href="#cb11-44" aria-hidden="true" tabindex="-1"></a>dist_to_river_pojo   <span class="ot">&lt;-</span> <span class="fu">rast</span>(<span class="st">"dist_to_river_pojo.tif"</span>)</span>
<span id="cb11-45"><a href="#cb11-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-46"><a href="#cb11-46" aria-hidden="true" tabindex="-1"></a>river_reclassified_pojo <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">classify</span>(dist_to_river_pojo, reclass_table_river, <span class="at">include.lowest =</span> <span class="cn">TRUE</span>, <span class="at">right =</span> <span class="cn">TRUE</span>)</span>
<span id="cb11-47"><a href="#cb11-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-48"><a href="#cb11-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-49"><a href="#cb11-49" aria-hidden="true" tabindex="-1"></a><span class="co"># totora</span></span>
<span id="cb11-50"><a href="#cb11-50" aria-hidden="true" tabindex="-1"></a>dist_to_river_totora <span class="ot">&lt;-</span> <span class="fu">rast</span>(<span class="st">"dist_to_river_totora.tif"</span>)</span>
<span id="cb11-51"><a href="#cb11-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-52"><a href="#cb11-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-53"><a href="#cb11-53" aria-hidden="true" tabindex="-1"></a>river_reclassified_totora <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">classify</span>(dist_to_river_totora, reclass_table_river, <span class="at">include.lowest =</span> <span class="cn">TRUE</span>, <span class="at">right =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="tbl-river-distance-Pasorapa" class="cell tbl-parent quarto-layout-panel anchored" data-tbl-cap="Reclassification table of the River-Distance Data">
<div class="panel-caption table-caption">
<p><strong>?(caption)</strong></p>
</div>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># change name</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(river_reclassified_pasorapa) <span class="ot">&lt;-</span> <span class="st">"Flood Risk"</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Color Palette in R</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>colors   <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"darkgreen"</span>,<span class="st">"lightgreen"</span>,<span class="st">"yellow"</span>, <span class="st">"orange"</span>,<span class="st">"red"</span>)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>colors_1 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"lightgreen"</span>,<span class="st">"yellow"</span>, <span class="st">"orange"</span>,<span class="st">"red"</span>)</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="co"># # Define the reclassification table</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="co"># reclass_table_modify &lt;- tribble(</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="co">#   ~from, ~to, ~becomes,</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="co">#   0, 0, 0.25  # Reclassify 0 to 0.25</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a><span class="co"># # Reclassify the river_reclassified_pasorapa raster</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a><span class="co"># river_reclassified_pasorapa &lt;- classify(river_reclassified_pasorapa, reclass_table_modify, include.lowest = TRUE, right = TRUE)</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a><span class="co"># view</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">"plot"</span>)</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(all_municipalities) <span class="sc">+</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>() <span class="sc">+</span></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(river_reclassified_pasorapa) <span class="sc">+</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_raster</span>(<span class="at">palette =</span> colors) <span class="sc">+</span> </span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(river_reclassified_aiquile) <span class="sc">+</span></span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_raster</span>(<span class="at">legend.show =</span> <span class="cn">FALSE</span>, <span class="at">palette =</span> colors) <span class="sc">+</span>  </span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(river_reclassified_totora) <span class="sc">+</span></span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_raster</span>(<span class="at">legend.show =</span> <span class="cn">FALSE</span>, <span class="at">palette =</span> colors) <span class="sc">+</span>  </span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(river_reclassified_pojo) <span class="sc">+</span></span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_raster</span>(<span class="at">legend.show =</span> <span class="cn">FALSE</span>, <span class="at">palette =</span> colors_1) <span class="sc">+</span>  </span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(all_municipalities) <span class="sc">+</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tm_borders</span>(<span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tm_layout</span>(<span class="at">frame =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_text</span>(<span class="st">"NAME_3"</span>, <span class="at">size =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tm_scale_bar</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">10</span>), <span class="at">text.size =</span> <span class="fl">0.9</span>, <span class="at">position =</span> <span class="fu">c</span>(<span class="st">"left"</span>)) <span class="sc">+</span>  </span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_compass</span>(<span class="at">type =</span> <span class="st">"4star"</span>, <span class="at">size =</span> <span class="dv">6</span>, <span class="at">position =</span> <span class="fu">c</span>(<span class="st">"right"</span>, <span class="st">"top"</span>)) <span class="sc">+</span></span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_credits</span>(<span class="st">"Author: Johannes Quente"</span>, <span class="at">fontface =</span> <span class="st">"italic"</span>, <span class="at">align =</span> <span class="st">"right"</span>) <span class="sc">+</span></span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_graticules</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(</span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text.size =</span> <span class="dv">1</span>,</span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="st">"left"</span>, <span class="st">"bottom"</span>),</span>
<span id="cb12-42"><a href="#cb12-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.outside =</span> <span class="cn">TRUE</span></span>
<span id="cb12-43"><a href="#cb12-43" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-river" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="Flood_Risk_files/figure-html/fig-river-1.png" class="img-fluid figure-img" width="480"></p>
<figcaption class="figure-caption">Figure&nbsp;3.1: Reclassification River Distance</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Downstream loop calc.</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to find all downstream rivers for a given river ID</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>find_downstream     <span class="ot">&lt;-</span> <span class="cf">function</span>(start_id, data) {</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  downstream_rivers <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">mode =</span> <span class="st">"numeric"</span>)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  current_id        <span class="ot">&lt;-</span> start_id</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">while</span> (<span class="sc">!</span><span class="fu">is.na</span>(current_id)) {</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    downstream_rivers <span class="ot">&lt;-</span> <span class="fu">c</span>(downstream_rivers, current_id)</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    current_id <span class="ot">&lt;-</span> data[data<span class="sc">$</span>river_id <span class="sc">==</span> current_id, <span class="st">"NEXT_DOWN"</span>]</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(downstream_rivers)</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Usage: Replace 'start_id' with your initial river ID</span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>start_id <span class="ot">&lt;-</span> <span class="dv">61259906</span></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">find_downstream</span>(start_id, river_crop)</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(result)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="do">### terra::distance calc.</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>river_crop <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(<span class="st">"river_crop.shp"</span>)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>buffer_river <span class="ot">&lt;-</span> <span class="fu">st_buffer</span>(river_crop, <span class="dv">100</span>)</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Create an empty raster to rasterize into</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>empty_raster <span class="ot">&lt;-</span> <span class="fu">raster</span>(<span class="fu">extent</span>(buffer_river), <span class="at">resolution =</span> <span class="fu">c</span>(<span class="fl">0.0008333333</span>, <span class="fl">0.0008333333</span>))</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Rasterize</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>river_raster <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rasterize</span>(buffer_river, empty_raster, <span class="at">field =</span> <span class="st">"CATCH_SKM"</span>, <span class="at">background =</span> <span class="dv">0</span>)</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calc into %</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>river_raster <span class="ot">&lt;-</span> (river_raster <span class="sc">/</span> <span class="dv">100</span>)</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(river_raster)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div style="page-break-after: always;"></div>
</section>
<section id="precipitation-data" class="level3" data-number="3.2.2">
<h3 data-number="3.2.2" class="anchored" data-anchor-id="precipitation-data"><span class="header-section-number">3.2.2</span> Precipitation Data</h3>
<p>The following Data provided by <span class="citation" data-cites="fick2017worldclim">Fick and Hijmans (<a href="references.html#ref-fick2017worldclim" role="doc-biblioref">2017</a>)</span> resembles Precipitation Data on a 30 Arc Second Accuracy. The format provides one Raster-Layer for each month.</p>
<p>Twelve raster layers have been aggregated to generate a unified raster layer, facilitating subsequent classification. The outcome is a comprehensive raster layer encompassing the total precipitation for the average year spanning from 1970 to 2000. The utilized code is available in the <a href="Appendix.html#sec-sec-precip">Appendix</a> In the reclassification process, values were partitioned into five equally distributed groups based on frequency, with each group representing 20% of the total data frequency. The distribution and grouping methodology are illustrated in <a href="#fig-hist-precip">Figure&nbsp;<span>3.2</span></a>. The reclassification has been calculated according to <a href="#tbl-data-weights-def">Table&nbsp;<span>3.2</span></a>.</p>
<div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>precip_pasorapa <span class="ot">&lt;-</span> <span class="fu">rast</span>(<span class="st">"sum_raster_pasorapa.tif"</span>)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>precip_aiquile  <span class="ot">&lt;-</span> <span class="fu">rast</span>(<span class="st">"sum_raster.tif"</span>)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>precip_pojo     <span class="ot">&lt;-</span> <span class="fu">rast</span>(<span class="st">"precip_pojo.tif"</span>)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>precip_totora   <span class="ot">&lt;-</span> <span class="fu">rast</span>(<span class="st">"precip_totora.tif"</span>)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>precip_todos    <span class="ot">&lt;-</span> <span class="fu">rast</span>(<span class="st">"precip_todos.tif"</span>)</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Reclass</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a tibble with the reclassification table</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>reclass_table_precip <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span>from, <span class="sc">~</span>to, <span class="sc">~</span>becomes,</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>  <span class="fl">1058.2</span>, <span class="cn">Inf</span>,     <span class="dv">1</span>,     </span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>  <span class="dv">640</span>,    <span class="fl">1058.2</span>,  <span class="fl">0.75</span>,  </span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>  <span class="dv">571</span>,    <span class="dv">640</span>,     <span class="fl">0.5</span>,   </span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>  <span class="fl">513.8</span>,  <span class="dv">571</span>,     <span class="fl">0.25</span>,  </span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>  <span class="sc">-</span><span class="cn">Inf</span>,   <span class="fl">513.8</span>,   <span class="dv">0</span>      </span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Reclassify the slope raster based on the reclassification table</span></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>precip_reclassified_pasorapa <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">classify</span>(precip_pasorapa, reclass_table_precip, <span class="at">include.lowest =</span> <span class="cn">TRUE</span>, <span class="at">right =</span> <span class="cn">TRUE</span>)</span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>precip_reclassified_aiquile <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">classify</span>(precip_aiquile, reclass_table_precip, <span class="at">include.lowest =</span> <span class="cn">TRUE</span>, <span class="at">right =</span> <span class="cn">TRUE</span>)</span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>precip_reclassified_pojo <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">classify</span>(precip_pojo, reclass_table_precip, <span class="at">include.lowest =</span> <span class="cn">TRUE</span>, <span class="at">right =</span> <span class="cn">TRUE</span>)</span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>precip_reclassified_totora <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">classify</span>(precip_totora, reclass_table_precip, <span class="at">include.lowest =</span> <span class="cn">TRUE</span>, <span class="at">right =</span> <span class="cn">TRUE</span>)</span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a><span class="co"># todos</span></span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a>precip_reclassified_todos <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">classify</span>(precip_todos, reclass_table_precip, <span class="at">include.lowest =</span> <span class="cn">TRUE</span>, <span class="at">right =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="tbl-precipitation" class="cell tbl-parent quarto-layout-panel anchored" data-tbl-cap="Reclassification table of the Precipitation Data">
<div class="panel-caption table-caption">
<p><strong>?(caption)</strong></p>
</div>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify the number of breaks (bins)</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>num_breaks <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>break_values <span class="ot">&lt;-</span> <span class="fu">quantile</span>(<span class="fu">values</span>(precip_todos, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">probs =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">length.out =</span> num_breaks <span class="sc">+</span> <span class="dv">1</span>))</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the histogram with equal-frequency breaks</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(<span class="fu">values</span>(precip_todos), <span class="at">breaks =</span> <span class="st">"FD"</span>, <span class="at">main =</span> <span class="st">"Histogram of Data Distribution"</span>, <span class="at">xlab =</span> <span class="st">"Precipitation (mm)"</span>, <span class="at">col =</span> <span class="st">"skyblue"</span>, <span class="at">border =</span> <span class="st">"black"</span>, <span class="at">plot =</span> <span class="cn">TRUE</span>)</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Add vertical lines to represent the breaks</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="fu">quantile</span>(<span class="fu">values</span>(precip_todos, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">probs =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">length.out =</span> num_breaks <span class="sc">+</span> <span class="dv">1</span>)), <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-hist-precip" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="Flood_Risk_files/figure-html/fig-hist-precip-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;3.2: Distribution of the Precipitation Data</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>colors   <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"darkgreen"</span>,<span class="st">"lightgreen"</span>,<span class="st">"yellow"</span>, <span class="st">"orange"</span>,<span class="st">"red"</span>)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co"># change name</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(precip_reclassified_todos) <span class="ot">&lt;-</span> <span class="st">"Flood Risk"</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(all_municipalities) <span class="sc">+</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>() <span class="sc">+</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(precip_reclassified_todos) <span class="sc">+</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_raster</span>(<span class="at">palette =</span> colors) <span class="sc">+</span> </span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(all_municipalities) <span class="sc">+</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tm_borders</span>(<span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tm_layout</span>(<span class="at">frame =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_text</span>(<span class="st">"NAME_3"</span>, <span class="at">size =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tm_scale_bar</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">10</span>), <span class="at">text.size =</span> <span class="fl">0.9</span>, <span class="at">position =</span> <span class="fu">c</span>(<span class="st">"left"</span>)) <span class="sc">+</span>  </span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_compass</span>(<span class="at">type =</span> <span class="st">"4star"</span>, <span class="at">size =</span> <span class="dv">6</span>, <span class="at">position =</span> <span class="fu">c</span>(<span class="st">"right"</span>, <span class="st">"top"</span>)) <span class="sc">+</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_credits</span>(<span class="st">"Author: Johannes Quente"</span>, <span class="at">fontface =</span> <span class="st">"italic"</span>, <span class="at">align =</span> <span class="st">"right"</span>) <span class="sc">+</span></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_graticules</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(</span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text.size =</span> <span class="dv">1</span>,</span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="st">"left"</span>, <span class="st">"bottom"</span>),</span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.outside =</span> <span class="cn">TRUE</span></span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-precipitation" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="Flood_Risk_files/figure-html/fig-precipitation-1.png" class="img-fluid figure-img" width="480"></p>
<figcaption class="figure-caption">Figure&nbsp;3.3: Reclassification Result of the Precipitation Data</figcaption>
</figure>
</div>
</div>
</div>
<div style="page-break-after: always;"></div>
</section>
<section id="dem-inclination-data" class="level3" data-number="3.2.3">
<h3 data-number="3.2.3" class="anchored" data-anchor-id="dem-inclination-data"><span class="header-section-number">3.2.3</span> DEM (Inclination) Data</h3>
<p>The provided Digital Elevation Model (DEM) consists of raster values showcasing variations in altitudes. These altitude values where converted into slope data using the <code>terra::terrain</code> -function from the Terra package. The reclassification has been calculated according to <a href="#tbl-data-weights-def">Table&nbsp;<span>3.2</span></a>.</p>
<p>Subsequently, the slope data was categorized into varying degrees of possibility of Flood in percent based on their inclination. For a detailed view of the reclassification code, please refer to the <a href="Appendix.html#sec-sec-inclination">Appendix</a>.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># read data</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Totora</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>dem_reclassified_totora  <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"dem_reclassified_totora.rds"</span>)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Aiquile</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>dem_reclassified_aiquile <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"dem_reclassified_aiquile.rds"</span>)</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Pasorapa</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>dem_reclassified_pasorapa <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"dem_reclassified_pasorapa.rds"</span>)</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Pojo</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>dem_reclassified_pojo    <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"dem_reclassified_pojo.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># DEM Pasorapa</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="do">##  crop and mask dem</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>dem_crop <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">crop</span>(dem, Pasorapa)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>dem_mask_pasorapa <span class="ot">&lt;-</span> <span class="fu">mask</span>(dem_crop, Pasorapa)</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>terrain_pasorapa <span class="ot">&lt;-</span> <span class="fu">terrain</span>(dem_mask_pasorapa)</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="co"># DEM Aiquile</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="do">##  crop and mask dem</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>dem_crop <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">crop</span>(dem, Aiquile)</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>dem_mask_Aiquile <span class="ot">&lt;-</span> <span class="fu">mask</span>(dem_crop, Aiquile)</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>terrain_dem_mask_Aiquile <span class="ot">&lt;-</span> <span class="fu">terrain</span>(dem_mask_Aiquile)</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a><span class="co"># DEM Totora</span></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a><span class="do">##  crop and mask dem</span></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>dem_crop <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">crop</span>(dem, totora)</span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>dem_mask_totora <span class="ot">&lt;-</span> <span class="fu">mask</span>(dem_crop, totora)</span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>terrain_totora <span class="ot">&lt;-</span> <span class="fu">terrain</span>(dem_mask_totora)</span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a><span class="co"># DEM Pojo</span></span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a><span class="do">##  crop and mask dem</span></span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a>dem_crop <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">crop</span>(dem, pojo)</span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a>dem_mask_pojo <span class="ot">&lt;-</span> <span class="fu">mask</span>(dem_crop, pojo)</span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a>terrain_pojo <span class="ot">&lt;-</span> <span class="fu">terrain</span>(dem_mask_pojo)</span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a tibble with the reclassification table</span></span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a>reclass_table_dem <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span>from, <span class="sc">~</span>to, <span class="sc">~</span>becomes,</span>
<span id="cb19-32"><a href="#cb19-32" aria-hidden="true" tabindex="-1"></a>  <span class="dv">0</span>, <span class="dv">10</span>, <span class="dv">1</span>,           <span class="co"># 0-10: Plano</span></span>
<span id="cb19-33"><a href="#cb19-33" aria-hidden="true" tabindex="-1"></a>  <span class="dv">10</span>, <span class="dv">20</span>, <span class="fl">0.56</span>,           <span class="co"># 10-20: Mod. inclinado</span></span>
<span id="cb19-34"><a href="#cb19-34" aria-hidden="true" tabindex="-1"></a>  <span class="dv">20</span>, <span class="dv">30</span>, <span class="fl">0.34</span>,          <span class="co"># 20-30: Inclinado</span></span>
<span id="cb19-35"><a href="#cb19-35" aria-hidden="true" tabindex="-1"></a>  <span class="dv">30</span>, <span class="dv">45</span>, <span class="fl">0.2</span>,          <span class="co"># 30-45: Mod. empinado</span></span>
<span id="cb19-36"><a href="#cb19-36" aria-hidden="true" tabindex="-1"></a>  <span class="dv">45</span>, <span class="cn">Inf</span>,<span class="fl">0.09</span>            <span class="co"># 45 and above: Fuert. empinado</span></span>
<span id="cb19-37"><a href="#cb19-37" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb19-38"><a href="#cb19-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-39"><a href="#cb19-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Assuming you have a slope raster 'slope_raster'</span></span>
<span id="cb19-40"><a href="#cb19-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Reclassify the slope raster based on the reclassification table</span></span>
<span id="cb19-41"><a href="#cb19-41" aria-hidden="true" tabindex="-1"></a>dem_reclassified_pasorapa <span class="ot">&lt;-</span> <span class="fu">classify</span>(terrain_pasorapa, reclass_table_dem, <span class="at">include.lowest =</span> <span class="cn">TRUE</span>, <span class="at">right =</span> <span class="cn">TRUE</span>)</span>
<span id="cb19-42"><a href="#cb19-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-43"><a href="#cb19-43" aria-hidden="true" tabindex="-1"></a>dem_reclassified_aiquile <span class="ot">&lt;-</span> <span class="fu">classify</span>(terrain_aiquile, reclass_table_dem, <span class="at">include.lowest =</span> <span class="cn">TRUE</span>, <span class="at">right =</span> <span class="cn">TRUE</span>)</span>
<span id="cb19-44"><a href="#cb19-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-45"><a href="#cb19-45" aria-hidden="true" tabindex="-1"></a>dem_reclassified_totora <span class="ot">&lt;-</span> <span class="fu">classify</span>(terrain_totora, reclass_table_dem, <span class="at">include.lowest =</span> <span class="cn">TRUE</span>, <span class="at">right =</span> <span class="cn">TRUE</span>)</span>
<span id="cb19-46"><a href="#cb19-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-47"><a href="#cb19-47" aria-hidden="true" tabindex="-1"></a>dem_reclassified_pojo <span class="ot">&lt;-</span> <span class="fu">classify</span>(terrain_pojo, reclass_table_dem, <span class="at">include.lowest =</span> <span class="cn">TRUE</span>, <span class="at">right =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define areas of interest</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>areas <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">pasorapa =</span> Pasorapa,</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">aiquile =</span> Aiquile,</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">totora =</span> totora,</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">pojo =</span> pojo</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a tibble with the reclassification table</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>reclass_table_dem <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span>from, <span class="sc">~</span>to, <span class="sc">~</span>becomes,</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>  <span class="dv">0</span>, <span class="dv">10</span>, <span class="dv">1</span>,           <span class="co"># 0-10: Plano</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>  <span class="dv">10</span>, <span class="dv">20</span>, <span class="fl">0.56</span>,       <span class="co"># 10-20: Mod. inclinado</span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>  <span class="dv">20</span>, <span class="dv">30</span>, <span class="fl">0.34</span>,       <span class="co"># 20-30: Inclinado</span></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>  <span class="dv">30</span>, <span class="dv">45</span>, <span class="fl">0.2</span>,        <span class="co"># 30-45: Mod. empinado</span></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>  <span class="dv">45</span>, <span class="cn">Inf</span>,<span class="fl">0.09</span>        <span class="co"># 45 and above: Fuert. empinado</span></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop through areas of interest</span></span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (area_name <span class="cf">in</span> <span class="fu">names</span>(areas)) {</span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Crop and mask dem</span></span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>  dem_crop <span class="ot">&lt;-</span> <span class="fu">crop</span>(dem, areas[[area_name]])</span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>  dem_mask <span class="ot">&lt;-</span> <span class="fu">mask</span>(dem_crop, areas[[area_name]])</span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate terrain</span></span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a>  terrain <span class="ot">&lt;-</span> <span class="fu">terrain</span>(dem_mask)</span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Reclassify DEM</span></span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a>  dem_reclassified <span class="ot">&lt;-</span> <span class="fu">classify</span>(terrain, reclass_table_dem, <span class="at">include.lowest =</span> <span class="cn">TRUE</span>, <span class="at">right =</span> <span class="cn">TRUE</span>)</span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-31"><a href="#cb20-31" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Assign to appropriate variable</span></span>
<span id="cb20-32"><a href="#cb20-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(<span class="fu">paste0</span>(<span class="st">"dem_reclassified_"</span>, area_name), dem_reclassified)</span>
<span id="cb20-33"><a href="#cb20-33" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># change name</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(dem_reclassified_aiquile) <span class="ot">&lt;-</span> <span class="st">"Flood Risk"</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="co"># view</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">"plot"</span>)</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(all_municipalities) <span class="sc">+</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>() <span class="sc">+</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(dem_reclassified_aiquile) <span class="sc">+</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_raster</span>(<span class="at">palette =</span> colors) <span class="sc">+</span> </span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(dem_reclassified_pasorapa) <span class="sc">+</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_raster</span>(<span class="at">legend.show =</span> <span class="cn">FALSE</span>, <span class="at">palette =</span> colors) <span class="sc">+</span>  </span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(dem_reclassified_pojo) <span class="sc">+</span></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_raster</span>(<span class="at">legend.show =</span> <span class="cn">FALSE</span>, <span class="at">palette =</span> colors) <span class="sc">+</span>  </span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(dem_reclassified_totora) <span class="sc">+</span></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_raster</span>(<span class="at">legend.show =</span> <span class="cn">FALSE</span>, <span class="at">palette =</span> colors) <span class="sc">+</span>  </span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(all_municipalities) <span class="sc">+</span></span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tm_borders</span>(<span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tm_layout</span>(<span class="at">frame =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_text</span>(<span class="st">"NAME_3"</span>, <span class="at">size =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tm_scale_bar</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">10</span>), <span class="at">text.size =</span> <span class="fl">0.9</span>, <span class="at">position =</span> <span class="fu">c</span>(<span class="st">"left"</span>)) <span class="sc">+</span>  </span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_compass</span>(<span class="at">type =</span> <span class="st">"4star"</span>, <span class="at">size =</span> <span class="dv">6</span>, <span class="at">position =</span> <span class="fu">c</span>(<span class="st">"right"</span>, <span class="st">"top"</span>)) <span class="sc">+</span></span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_credits</span>(<span class="st">"Author: Johannes Quente"</span>, <span class="at">fontface =</span> <span class="st">"italic"</span>, <span class="at">align =</span> <span class="st">"right"</span>) <span class="sc">+</span></span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_graticules</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(</span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text.size =</span> <span class="dv">1</span>,</span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="st">"left"</span>, <span class="st">"bottom"</span>),</span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.outside =</span> <span class="cn">TRUE</span></span>
<span id="cb21-30"><a href="#cb21-30" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-dem-inclination" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="Flood_Risk_files/figure-html/fig-dem-inclination-1.png" class="img-fluid figure-img" width="480"></p>
<figcaption class="figure-caption">Figure&nbsp;3.4: Reclassification of DEM derived Inclination</figcaption>
</figure>
</div>
</div>
</div>
<div style="page-break-after: always;"></div>
</section>
</section>
<section id="results-flood-risk" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="results-flood-risk"><span class="header-section-number">3.3</span> Results Flood Risk</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Aiquile</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Resample aspect raster to match the extent and resolution of min_temp_pasorapa_reclassified</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>precip_reclassified <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">resample</span>(precip_reclassified_aiquile, dem_reclassified_aiquile)</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>river_reclassified <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">resample</span>(river_reclassified_aiquile, precip_reclassified)</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Adjusted weights</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>weight_river    <span class="ot">&lt;-</span> <span class="fl">0.25</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>weight_dem      <span class="ot">&lt;-</span> <span class="fl">0.35</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>weight_precip   <span class="ot">&lt;-</span> <span class="fl">0.4</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform the adjusted weighted combination</span></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>final_raster <span class="ot">&lt;-</span> weight_river    <span class="sc">*</span> river_reclassified <span class="sc">+</span></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>                weight_precip   <span class="sc">*</span> precip_reclassified <span class="sc">+</span></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>                weight_dem      <span class="sc">*</span> dem_reclassified_aiquile</span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>final_raster_aiquile <span class="ot">&lt;-</span> final_raster</span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a><span class="do">### Pojo</span></span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Resample aspect raster to match the extent and resolution of min_temp_pasorapa_reclassified</span></span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a>precip_reclassified <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">resample</span>(precip_reclassified_pojo, dem_reclassified_pojo)</span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a>river_reclassified <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">resample</span>(river_reclassified_pojo, precip_reclassified)</span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform the adjusted weighted combination</span></span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a>final_raster <span class="ot">&lt;-</span> weight_river    <span class="sc">*</span> river_reclassified <span class="sc">+</span></span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a>                weight_precip   <span class="sc">*</span> precip_reclassified <span class="sc">+</span></span>
<span id="cb22-31"><a href="#cb22-31" aria-hidden="true" tabindex="-1"></a>                weight_dem      <span class="sc">*</span> dem_reclassified_pojo</span>
<span id="cb22-32"><a href="#cb22-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-33"><a href="#cb22-33" aria-hidden="true" tabindex="-1"></a>final_raster_pojo <span class="ot">&lt;-</span> final_raster</span>
<span id="cb22-34"><a href="#cb22-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-35"><a href="#cb22-35" aria-hidden="true" tabindex="-1"></a><span class="do">### Pasorapa</span></span>
<span id="cb22-36"><a href="#cb22-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-37"><a href="#cb22-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Resample aspect raster to match the extent and resolution of min_temp_pasorapa_reclassified</span></span>
<span id="cb22-38"><a href="#cb22-38" aria-hidden="true" tabindex="-1"></a>precip_reclassified <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">resample</span>(precip_reclassified_pasorapa, dem_reclassified_pasorapa)</span>
<span id="cb22-39"><a href="#cb22-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-40"><a href="#cb22-40" aria-hidden="true" tabindex="-1"></a>river_reclassified <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">resample</span>(river_reclassified_pasorapa, precip_reclassified)</span>
<span id="cb22-41"><a href="#cb22-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-42"><a href="#cb22-42" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform the adjusted weighted combination</span></span>
<span id="cb22-43"><a href="#cb22-43" aria-hidden="true" tabindex="-1"></a>final_raster <span class="ot">&lt;-</span> weight_river    <span class="sc">*</span> river_reclassified <span class="sc">+</span></span>
<span id="cb22-44"><a href="#cb22-44" aria-hidden="true" tabindex="-1"></a>                weight_precip   <span class="sc">*</span> precip_reclassified <span class="sc">+</span></span>
<span id="cb22-45"><a href="#cb22-45" aria-hidden="true" tabindex="-1"></a>                weight_dem      <span class="sc">*</span> dem_reclassified_pasorapa</span>
<span id="cb22-46"><a href="#cb22-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-47"><a href="#cb22-47" aria-hidden="true" tabindex="-1"></a>final_raster_pasorapa <span class="ot">&lt;-</span> final_raster</span>
<span id="cb22-48"><a href="#cb22-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-49"><a href="#cb22-49" aria-hidden="true" tabindex="-1"></a><span class="do">### Totora</span></span>
<span id="cb22-50"><a href="#cb22-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-51"><a href="#cb22-51" aria-hidden="true" tabindex="-1"></a><span class="co"># Resample aspect raster to match the extent and resolution of min_temp_pasorapa_reclassified</span></span>
<span id="cb22-52"><a href="#cb22-52" aria-hidden="true" tabindex="-1"></a>precip_reclassified <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">resample</span>(precip_reclassified_totora, dem_reclassified_totora)</span>
<span id="cb22-53"><a href="#cb22-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-54"><a href="#cb22-54" aria-hidden="true" tabindex="-1"></a>river_reclassified <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">resample</span>(river_reclassified_totora, precip_reclassified)</span>
<span id="cb22-55"><a href="#cb22-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-56"><a href="#cb22-56" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform the adjusted weighted combination</span></span>
<span id="cb22-57"><a href="#cb22-57" aria-hidden="true" tabindex="-1"></a>final_raster <span class="ot">&lt;-</span> weight_river    <span class="sc">*</span> river_reclassified <span class="sc">+</span></span>
<span id="cb22-58"><a href="#cb22-58" aria-hidden="true" tabindex="-1"></a>                weight_precip   <span class="sc">*</span> precip_reclassified <span class="sc">+</span></span>
<span id="cb22-59"><a href="#cb22-59" aria-hidden="true" tabindex="-1"></a>                weight_dem      <span class="sc">*</span> dem_reclassified_totora</span>
<span id="cb22-60"><a href="#cb22-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-61"><a href="#cb22-61" aria-hidden="true" tabindex="-1"></a>final_raster_totora <span class="ot">&lt;-</span> final_raster</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the municipalities</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>municipalities <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"pojo"</span>, <span class="st">"pasorapa"</span>, <span class="st">"aiquile"</span>, <span class="st">"totora"</span>)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the number of breaks (bins)</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>num_breaks <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize an empty list to store numeric breaks for each municipality</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>numeric_breaks_list <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop over each municipality</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (municipality <span class="cf">in</span> municipalities) {</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get the final raster data for the current municipality</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>  final_raster <span class="ot">&lt;-</span> <span class="cf">switch</span>(municipality,</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>                         <span class="at">pojo =</span> final_raster_pojo,</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>                         <span class="at">pasorapa =</span> final_raster_pasorapa,</span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>                         <span class="at">aiquile =</span> final_raster_aiquile,</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>                         <span class="at">totora =</span> final_raster_totora)</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Compute the break values</span></span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>    break_values <span class="ot">&lt;-</span> <span class="fu">quantile</span>(<span class="fu">values</span>(final_raster, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">probs =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">length.out =</span> num_breaks <span class="sc">+</span> <span class="dv">1</span>))</span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Store the numeric breaks in the list</span></span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>  numeric_breaks_list[[municipality]] <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(break_values))</span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Capitalize the first letter of the municipality name</span></span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a>    capitalized_municipality <span class="ot">&lt;-</span> <span class="fu">str_to_title</span>(municipality)</span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create the histogram with equal-frequency breaks</span></span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">hist</span>(<span class="fu">values</span>(final_raster), <span class="at">breaks =</span> <span class="st">"FD"</span>, <span class="at">main =</span> <span class="fu">paste</span>(<span class="st">"Histogram of Flood Risk for"</span>, capitalized_municipality), <span class="at">xlab =</span> <span class="st">"Flood Risk Values"</span>, <span class="at">col =</span> <span class="st">"skyblue"</span>, <span class="at">border =</span> <span class="st">"black"</span>, <span class="at">plot =</span> <span class="cn">TRUE</span>)</span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add vertical lines to represent the breaks</span></span>
<span id="cb23-32"><a href="#cb23-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">abline</span>(<span class="at">v =</span> break_values, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb23-33"><a href="#cb23-33" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="fig-histogram-distribution" class="cell quarto-layout-panel">
<figure class="figure">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-histogram-distribution-1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="Flood_Risk_files/figure-html/fig-histogram-distribution-1.png" class="img-fluid figure-img" data-ref-parent="fig-histogram-distribution" width="672"></p>
<figcaption class="figure-caption">(a) Distribution of Pojo</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-histogram-distribution-2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="Flood_Risk_files/figure-html/fig-histogram-distribution-2.png" class="img-fluid figure-img" data-ref-parent="fig-histogram-distribution" width="672"></p>
<figcaption class="figure-caption">(b) Distribution of Pasorapa</figcaption>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-histogram-distribution-3" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="Flood_Risk_files/figure-html/fig-histogram-distribution-3.png" class="img-fluid figure-img" data-ref-parent="fig-histogram-distribution" width="672"></p>
<figcaption class="figure-caption">(c) Distribution of Aiquile</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-histogram-distribution-4" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="Flood_Risk_files/figure-html/fig-histogram-distribution-4.png" class="img-fluid figure-img" data-ref-parent="fig-histogram-distribution" width="672"></p>
<figcaption class="figure-caption">(d) Distribution of Totora</figcaption>
</figure>
</div>
</div>
</div>
<p></p><figcaption class="figure-caption">Figure&nbsp;3.5: Data Distribution of the four Municipalities</figcaption><p></p>
</figure>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define breaks and labels for the reclassification</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>breaks_list <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">pojo =</span> numeric_breaks_list<span class="sc">$</span>pojo,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">pasorapa =</span> numeric_breaks_list<span class="sc">$</span>pasorapa,</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">aiquile =</span> numeric_breaks_list<span class="sc">$</span>aiquile,</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">totora =</span> numeric_breaks_list<span class="sc">$</span>totora</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>labels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Muy bajo"</span>, <span class="st">"Bajo"</span>, <span class="st">"Moderado"</span>, <span class="st">"Alto"</span>, <span class="st">"Muy alto"</span>)</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize an empty list to store categorized rasters for each municipality</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>categorized_rasters <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop over each municipality</span></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (municipality <span class="cf">in</span> municipalities) {</span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get the final raster data for the current municipality</span></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>  final_raster <span class="ot">&lt;-</span> <span class="cf">switch</span>(municipality,</span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>                         <span class="at">pojo =</span> final_raster_pojo,</span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>                         <span class="at">pasorapa =</span> final_raster_pasorapa,</span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>                         <span class="at">aiquile =</span> final_raster_aiquile,</span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>                         <span class="at">totora =</span> final_raster_totora)</span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Define breaks for the current municipality</span></span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a>  breaks <span class="ot">&lt;-</span> breaks_list[[municipality]]</span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Cut the raster values into categorical factors</span></span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a>  factor_raster <span class="ot">&lt;-</span> <span class="fu">cut</span>(<span class="fu">values</span>(final_raster), <span class="at">breaks =</span> breaks, <span class="at">labels =</span> labels, <span class="at">include.lowest =</span> <span class="cn">TRUE</span>)</span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-29"><a href="#cb24-29" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Change the name of the raster</span></span>
<span id="cb24-30"><a href="#cb24-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(final_raster) <span class="ot">&lt;-</span> <span class="st">"Flood Risk"</span></span>
<span id="cb24-31"><a href="#cb24-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-32"><a href="#cb24-32" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create a new raster with categorized values</span></span>
<span id="cb24-33"><a href="#cb24-33" aria-hidden="true" tabindex="-1"></a>  r_categorized <span class="ot">&lt;-</span> final_raster</span>
<span id="cb24-34"><a href="#cb24-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">values</span>(r_categorized) <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(factor_raster)</span>
<span id="cb24-35"><a href="#cb24-35" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-36"><a href="#cb24-36" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Store the categorized raster in the list</span></span>
<span id="cb24-37"><a href="#cb24-37" aria-hidden="true" tabindex="-1"></a>  categorized_rasters[[municipality]] <span class="ot">&lt;-</span> r_categorized</span>
<span id="cb24-38"><a href="#cb24-38" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb24-39"><a href="#cb24-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-40"><a href="#cb24-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Access categorized raster for a specific municipality</span></span>
<span id="cb24-41"><a href="#cb24-41" aria-hidden="true" tabindex="-1"></a><span class="co"># categorized_rasters$pasorapa</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># change name</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(categorized_rasters<span class="sc">$</span>pojo) <span class="ot">&lt;-</span> <span class="st">"Flood Risk"</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(all_municipalities) <span class="sc">+</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>() <span class="sc">+</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(categorized_rasters<span class="sc">$</span>pojo) <span class="sc">+</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_raster</span>(<span class="at">palette =</span> colors) <span class="sc">+</span>  </span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(categorized_rasters<span class="sc">$</span>pasorapa) <span class="sc">+</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_raster</span>(<span class="at">legend.show =</span> <span class="cn">FALSE</span>, <span class="at">palette =</span> colors) <span class="sc">+</span>  </span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(categorized_rasters<span class="sc">$</span>aiquile) <span class="sc">+</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_raster</span>(<span class="at">legend.show =</span> <span class="cn">FALSE</span>, <span class="at">palette =</span> colors) <span class="sc">+</span>  </span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(categorized_rasters<span class="sc">$</span>totora) <span class="sc">+</span></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_raster</span>(<span class="at">legend.show =</span> <span class="cn">FALSE</span>, <span class="at">palette =</span> colors) <span class="sc">+</span>  </span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(all_municipalities) <span class="sc">+</span></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tm_borders</span>(<span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tm_layout</span>(<span class="at">frame =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_text</span>(<span class="st">"NAME_3"</span>, <span class="at">size =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tm_scale_bar</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">10</span>), <span class="at">text.size =</span> <span class="fl">0.9</span>, <span class="at">position =</span> <span class="fu">c</span>(<span class="st">"left"</span>)) <span class="sc">+</span>  </span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_compass</span>(<span class="at">type =</span> <span class="st">"4star"</span>, <span class="at">size =</span> <span class="dv">6</span>, <span class="at">position =</span> <span class="fu">c</span>(<span class="st">"right"</span>, <span class="st">"top"</span>)) <span class="sc">+</span></span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_credits</span>(<span class="st">"Author: Johannes Quente"</span>, <span class="at">fontface =</span> <span class="st">"italic"</span>, <span class="at">align =</span> <span class="st">"right"</span>) <span class="sc">+</span></span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_graticules</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(</span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text.size =</span> <span class="dv">1</span>,</span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="st">"left"</span>, <span class="st">"bottom"</span>),</span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.outside =</span> <span class="cn">TRUE</span></span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-all-results-flood" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="Flood_Risk_files/figure-html/fig-all-results-flood-1.png" class="img-fluid figure-img" width="480"></p>
<figcaption class="figure-caption">Figure&nbsp;3.6: Result Flood Risk for each Municipality</figcaption>
</figure>
</div>
</div>
</div>


<!-- -->

<div id="refs" class="references csl-bib-body hanging-indent" role="list" style="display: none">
<div id="ref-fick2017worldclim" class="csl-entry" role="listitem">
Fick, Stephen E., and Robert J. Hijmans. 2017. <span>“WorldClim 2: New 1km Spatial Resolution Climate Surfaces for Global Land Areas.”</span> <em>International Journal of Climatology</em> 37 (12): 4302–15. <a href="https://www.worldclim.org/data/worldclim21.html">https://www.worldclim.org/data/worldclim21.html</a>.
</div>
<div id="ref-Gao2023" class="csl-entry" role="listitem">
Gao, Fengjie, Si Zhang, Rui Yu, Yafang Zhao, Yuxin Chen, and Ying Zhang. 2023. <span>“Agricultural Drought Risk Assessment Based on a Comprehensive Model Using Geospatial Techniques in Songnen Plain, China.”</span> <em>Land</em> 12 (June). <a href="https://doi.org/10.3390/land12061184">https://doi.org/10.3390/land12061184</a>.
</div>
<div id="ref-Hagos2022" class="csl-entry" role="listitem">
Hagos, Yonas Gebresilasie, Tesfa Gebrie Andualem, · Mesenbet Yibeltal, · Mequanent, and Abathun Mengie. 2022. <span>“Flood Hazard Assessment and Mapping Using GIS Integrated with Multi-Criteria Decision Analysis in Upper Awash River Basin, Ethiopia”</span> 12: 148. <a href="https://doi.org/10.1007/s13201-022-01674-8">https://doi.org/10.1007/s13201-022-01674-8</a>.
</div>
<div id="ref-linke2019global" class="csl-entry" role="listitem">
Linke, Simon, Bernhard Lehner, Cynthia Ouellet Dallaire, Joyce Ariwi, Günther Grill, Manu Anand, Paul Beames, et al. 2019. <span>“Global Hydro-Environmental Sub-Basin and River Reach Characteristics at High Spatial Resolution.”</span> <em>Scientific Data</em> 6: 283. <a href="https://doi.org/10.1038/s41597-019-0300-6">https://doi.org/10.1038/s41597-019-0300-6</a>.
</div>
</div>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./Frost_Risk.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Frost Risk</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./references.html" class="pagination-link">
        <span class="nav-page-text">References</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb26" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Flood Risk"</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="an">editor_options:</span><span class="co"> </span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="co">  chunk_output_type: console</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="co">  </span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="an">execute:</span><span class="co"> </span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="co">  echo: true</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a><span class="co">  message: false</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a><span class="co">  warning: false</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a><span class="fu">## Frame of Reference {#sec-sec-flood}</span></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>This research presents a low-cost and flexible methodology for mapping flood hazard and assessing resulting risk. The methodology is generic and can be customized for freely available data with global coverage, allowing for worldwide risk assessment. Region-specific information can be added to the default workflow when available.</span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>Floods are a significant global hazard, posing threats to both human societies and natural ecosystems. The increase in flood occurrences is caused by the interaction between climate variations and changes in land-use patterns. These dynamics put significant stress on river systems, leading to significant changes in river morphology <span class="co">[</span><span class="ot">@Hagos2022</span><span class="co">]</span>.</span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a>This study aims to evaluate flood risk and identify inundation zones in the Valle Alto region of Cochabamba, including Aiquile, Pasorapa, Pojo, and Totoro. The genesis of floods is influenced by various factors such as soil properties, terrain slope, elevation, drainage density, and land cover characteristics. In Bolivia, some of these factors were included in the analysis framework due to limited data availability.</span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a>The analytic hierarchy process was used to determine the relative weights assigned to each contributing factor, incorporating insights from public institutions and expert consensus. The acquired data was processed in the R-Studio environment to construct a comprehensive flood hazard map.</span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a>The aim of this study is to inform evidence-based decision-making processes, ultimately enhancing the resilience of communities and ecosystems to flood-related hazards.</span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval=FALSE}</span></span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a><span class="sc">|</span> Source <span class="sc">|</span> Description <span class="sc">|</span></span>
<span id="cb26-26"><a href="#cb26-26" aria-hidden="true" tabindex="-1"></a><span class="er">|</span> <span class="sc">------</span> <span class="er">|</span> <span class="sc">-----------</span> <span class="er">|</span></span>
<span id="cb26-27"><a href="#cb26-27" aria-hidden="true" tabindex="-1"></a><span class="er">|</span> [Applied Water Science](https<span class="sc">:</span><span class="er">//</span>link.springer.com<span class="sc">/</span>article<span class="sc">/</span><span class="fl">10.1007</span><span class="sc">/</span>s13201<span class="dv">-022-01674-8</span>) <span class="sc">|</span> Study on <span class="st">"Flood hazard assessment and mapping using GIS integrated with multi-criteria decision analysis in upper Awash River basin, Ethiopia"</span>. <span class="sc">|</span></span>
<span id="cb26-28"><a href="#cb26-28" aria-hidden="true" tabindex="-1"></a><span class="er">|</span> [MDPI](https<span class="sc">:</span><span class="er">//</span>www.mdpi.com<span class="sc">/</span><span class="dv">2073-4441</span><span class="sc">/</span><span class="dv">11</span><span class="sc">/</span><span class="dv">11</span><span class="sc">/</span><span class="dv">2371</span><span class="sc">/</span>htm) <span class="sc">|</span> Flexible methodology and toolbox <span class="cf">for</span> flood risk mapping worldwide. <span class="sc">|</span></span>
<span id="cb26-29"><a href="#cb26-29" aria-hidden="true" tabindex="-1"></a><span class="er">|</span> [Sustainability](https<span class="sc">:</span><span class="er">//</span>www.mdpi.com<span class="sc">/</span><span class="dv">2071-1050</span><span class="sc">/</span><span class="dv">14</span><span class="sc">/</span><span class="dv">8</span><span class="sc">/</span><span class="dv">4483</span>) <span class="sc">|</span> Study on <span class="st">"Urban Flood-Risk Assessment and Management Using Integrated Multi-Parameter Decision-Making Approach and Geospatial Techniques"</span>. <span class="sc">|</span></span>
<span id="cb26-30"><a href="#cb26-30" aria-hidden="true" tabindex="-1"></a><span class="er">|</span> [Springer](https<span class="sc">:</span><span class="er">//</span>link.springer.com<span class="sc">/</span>referenceworkentry<span class="sc">/</span><span class="fl">10.1007</span><span class="sc">/</span><span class="dv">978-981-16-8800</span><span class="sc">-</span>3_177<span class="dv">-1</span>) <span class="sc">|</span> Risk Mapping <span class="cf">in</span> Managing Flood Vulnerability <span class="cf">in</span> Disaster Management. <span class="sc">|</span></span>
<span id="cb26-31"><a href="#cb26-31" aria-hidden="true" tabindex="-1"></a><span class="er">|</span> [MDPI](https<span class="sc">:</span><span class="er">//</span>www.mdpi.com<span class="sc">/</span><span class="dv">2071-1050</span><span class="sc">/</span><span class="dv">14</span><span class="sc">/</span><span class="dv">6</span><span class="sc">/</span><span class="dv">3251</span>) <span class="sc">|</span> Flood Hazard and Risk Mapping by Applying an Explainable Machine Learning Framework Using Satellite Imagery and GIS Data. <span class="sc">|</span></span>
<span id="cb26-32"><a href="#cb26-32" aria-hidden="true" tabindex="-1"></a><span class="er">|</span> [MDPI](https<span class="sc">:</span><span class="er">//</span>www.mdpi.com<span class="sc">/</span><span class="dv">2073-4441</span><span class="sc">/</span><span class="dv">11</span><span class="sc">/</span><span class="dv">11</span><span class="sc">/</span><span class="dv">2371</span>) <span class="sc">|</span> Flood Risk Mapping Worldwide<span class="sc">:</span> A Flexible Methodology and Toolbox. <span class="sc">|</span></span>
<span id="cb26-33"><a href="#cb26-33" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-34"><a href="#cb26-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-35"><a href="#cb26-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-36"><a href="#cb26-36" aria-hidden="true" tabindex="-1"></a><span class="in">```{r libraries}</span></span>
<span id="cb26-37"><a href="#cb26-37" aria-hidden="true" tabindex="-1"></a><span class="co"># read libraries</span></span>
<span id="cb26-38"><a href="#cb26-38" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(raster)</span>
<span id="cb26-39"><a href="#cb26-39" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(terra)</span>
<span id="cb26-40"><a href="#cb26-40" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb26-41"><a href="#cb26-41" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tmap)</span>
<span id="cb26-42"><a href="#cb26-42" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb26-43"><a href="#cb26-43" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb26-44"><a href="#cb26-44" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tibble)</span>
<span id="cb26-45"><a href="#cb26-45" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb26-46"><a href="#cb26-46" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb26-47"><a href="#cb26-47" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-48"><a href="#cb26-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-51"><a href="#cb26-51" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb26-52"><a href="#cb26-52" aria-hidden="true" tabindex="-1"></a><span class="co"># read data</span></span>
<span id="cb26-53"><a href="#cb26-53" aria-hidden="true" tabindex="-1"></a>bol   <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(<span class="st">"gadm41_BOL_3.shp"</span>, <span class="at">crs =</span> <span class="dv">4326</span>)</span>
<span id="cb26-54"><a href="#cb26-54" aria-hidden="true" tabindex="-1"></a>cocha <span class="ot">&lt;-</span> bol <span class="sc">%&gt;%</span> <span class="fu">filter</span>(NAME_1 <span class="sc">==</span> <span class="st">"Cochabamba"</span>)</span>
<span id="cb26-55"><a href="#cb26-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-56"><a href="#cb26-56" aria-hidden="true" tabindex="-1"></a>Pasorapa <span class="ot">&lt;-</span> cocha <span class="sc">%&gt;%</span> <span class="fu">filter</span>(NAME_3 <span class="sc">==</span> <span class="st">"Pasorapa"</span>)</span>
<span id="cb26-57"><a href="#cb26-57" aria-hidden="true" tabindex="-1"></a>Aiquile  <span class="ot">&lt;-</span> cocha <span class="sc">%&gt;%</span> <span class="fu">filter</span>(NAME_3 <span class="sc">==</span> <span class="st">"Aiquile"</span>)</span>
<span id="cb26-58"><a href="#cb26-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-59"><a href="#cb26-59" aria-hidden="true" tabindex="-1"></a><span class="co"># new</span></span>
<span id="cb26-60"><a href="#cb26-60" aria-hidden="true" tabindex="-1"></a>totora   <span class="ot">&lt;-</span> cocha <span class="sc">%&gt;%</span> <span class="fu">filter</span>(NAME_3 <span class="sc">==</span> <span class="st">"Totora"</span>)</span>
<span id="cb26-61"><a href="#cb26-61" aria-hidden="true" tabindex="-1"></a>pojo     <span class="ot">&lt;-</span> cocha <span class="sc">%&gt;%</span> <span class="fu">filter</span>(NAME_3 <span class="sc">==</span> <span class="st">"Pojo"</span>)</span>
<span id="cb26-62"><a href="#cb26-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-63"><a href="#cb26-63" aria-hidden="true" tabindex="-1"></a><span class="co"># set extent</span></span>
<span id="cb26-64"><a href="#cb26-64" aria-hidden="true" tabindex="-1"></a>all_municipalities <span class="ot">&lt;-</span> <span class="fu">rbind</span>(Pasorapa, Aiquile, totora, pojo)</span>
<span id="cb26-65"><a href="#cb26-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-66"><a href="#cb26-66" aria-hidden="true" tabindex="-1"></a><span class="co"># read dm-raster</span></span>
<span id="cb26-67"><a href="#cb26-67" aria-hidden="true" tabindex="-1"></a>dem <span class="ot">&lt;-</span> <span class="fu">rast</span>(<span class="st">"s20w070_dem.tif"</span>)</span>
<span id="cb26-68"><a href="#cb26-68" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-69"><a href="#cb26-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-70"><a href="#cb26-70" aria-hidden="true" tabindex="-1"></a><span class="fu">## Methodology of the Case Study</span></span>
<span id="cb26-71"><a href="#cb26-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-72"><a href="#cb26-72" aria-hidden="true" tabindex="-1"></a>In order to conduct this Multicriteria Analysis, a comparable approach to @Hagos2022 has been undertaken. The analysis employs numerous raster and vector layers, integrating weighted factors. The entire project is conducted within the R-Studio environment. Key packages utilized in achieving the final results are listed in <span class="co">[</span><span class="ot">R-Studio Libraries</span><span class="co">](#sec-sec-libraries)</span>, providing essential functions for the conducted calculations. The following data has been used.</span>
<span id="cb26-73"><a href="#cb26-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-74"><a href="#cb26-74" aria-hidden="true" tabindex="-1"></a>@tbl-data-Pasorapa shows the data used in order to conduct the Multicriteria Analysis on the four municipalities in the Cono Sur Region in Cochabamba, Bolivia.</span>
<span id="cb26-75"><a href="#cb26-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-76"><a href="#cb26-76" aria-hidden="true" tabindex="-1"></a>@tbl-data-weights-def presents the classification and evaluation of various criteria for drought exposure, illustrating the factors influencing each classification. This table outlines the criteria and their corresponding classifications as follows.</span>
<span id="cb26-77"><a href="#cb26-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-78"><a href="#cb26-78" aria-hidden="true" tabindex="-1"></a>The subsequent sections present the reclassified data for four municipalities in the state of Cochabamba. These sections detail the process of cleaning and further processing the raw data, with relevant code snippets linked to the Appendix for reference.</span>
<span id="cb26-79"><a href="#cb26-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-80"><a href="#cb26-80" aria-hidden="true" tabindex="-1"></a><span class="in">```{r table_shapes}</span></span>
<span id="cb26-81"><a href="#cb26-81" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-data-Pasorapa</span></span>
<span id="cb26-82"><a href="#cb26-82" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "Used Data in the Analysis"</span></span>
<span id="cb26-83"><a href="#cb26-83" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-colwidths: [20, 20, 20, 20]</span></span>
<span id="cb26-84"><a href="#cb26-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-85"><a href="#cb26-85" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating a table</span></span>
<span id="cb26-86"><a href="#cb26-86" aria-hidden="true" tabindex="-1"></a>shapes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Political Map"</span>, <span class="st">"River Data"</span>, <span class="st">"Precipitation"</span>, <span class="st">"DEM (Inclination)"</span>)</span>
<span id="cb26-87"><a href="#cb26-87" aria-hidden="true" tabindex="-1"></a>data_type <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Vector"</span>, <span class="st">"Vector"</span>, <span class="st">"Raster (30 s)"</span>, <span class="st">"Raster (15 s)"</span>)</span>
<span id="cb26-88"><a href="#cb26-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-89"><a href="#cb26-89" aria-hidden="true" tabindex="-1"></a>sources <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb26-90"><a href="#cb26-90" aria-hidden="true" tabindex="-1"></a>  <span class="st">"[gadm.org](https://gadm.org/download_country.html)"</span>,</span>
<span id="cb26-91"><a href="#cb26-91" aria-hidden="true" tabindex="-1"></a>  <span class="st">"@linke2019global"</span>,</span>
<span id="cb26-92"><a href="#cb26-92" aria-hidden="true" tabindex="-1"></a>  <span class="st">"@fick2017worldclim"</span>, </span>
<span id="cb26-93"><a href="#cb26-93" aria-hidden="true" tabindex="-1"></a>  <span class="st">"[Hydrosheds.org](https://www.hydrosheds.org/hydrosheds-core-downloads)"</span>)</span>
<span id="cb26-94"><a href="#cb26-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-95"><a href="#cb26-95" aria-hidden="true" tabindex="-1"></a>period <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"2024"</span>, <span class="st">"2013"</span>, <span class="st">"1970-2000"</span>, <span class="st">"2013"</span>)</span>
<span id="cb26-96"><a href="#cb26-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-97"><a href="#cb26-97" aria-hidden="true" tabindex="-1"></a><span class="co"># Repeat the sources based on the number of shapes</span></span>
<span id="cb26-98"><a href="#cb26-98" aria-hidden="true" tabindex="-1"></a>repeated_sources <span class="ot">&lt;-</span> <span class="fu">rep</span>(sources, <span class="at">length.out =</span> <span class="fu">length</span>(shapes))</span>
<span id="cb26-99"><a href="#cb26-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-100"><a href="#cb26-100" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the data frame</span></span>
<span id="cb26-101"><a href="#cb26-101" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Data =</span> shapes, <span class="at">Types =</span> data_type, <span class="at">Source =</span> repeated_sources, <span class="at">Period_Year =</span> period)</span>
<span id="cb26-102"><a href="#cb26-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-103"><a href="#cb26-103" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(data) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Data"</span>, <span class="st">"Types"</span>, <span class="st">"Source"</span>, <span class="st">"Period/Year"</span>)</span>
<span id="cb26-104"><a href="#cb26-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-105"><a href="#cb26-105" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(data)</span>
<span id="cb26-106"><a href="#cb26-106" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-107"><a href="#cb26-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-110"><a href="#cb26-110" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb26-111"><a href="#cb26-111" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-data-weights-def</span></span>
<span id="cb26-112"><a href="#cb26-112" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "Classiﬁcation and evaluation of drought exposure according to factors"</span></span>
<span id="cb26-113"><a href="#cb26-113" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-colwidths: [20, 20, 20]</span></span>
<span id="cb26-114"><a href="#cb26-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-115"><a href="#cb26-115" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating a sample data frame</span></span>
<span id="cb26-116"><a href="#cb26-116" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb26-117"><a href="#cb26-117" aria-hidden="true" tabindex="-1"></a>  <span class="at">Criteria =</span> <span class="fu">c</span>(<span class="st">"River Data"</span>, <span class="st">"Precipitation"</span>, <span class="st">"DEM (Inclination)"</span>),</span>
<span id="cb26-118"><a href="#cb26-118" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">Very High</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"&lt;200"</span>, <span class="st">"&gt;1058"</span>, <span class="st">"&lt;10"</span>),</span>
<span id="cb26-119"><a href="#cb26-119" aria-hidden="true" tabindex="-1"></a>  <span class="at">High        =</span> <span class="fu">c</span>(<span class="st">"200-700"</span>, <span class="st">"640-1058"</span>, <span class="st">"10-20"</span>),</span>
<span id="cb26-120"><a href="#cb26-120" aria-hidden="true" tabindex="-1"></a>  <span class="at">Moderate    =</span> <span class="fu">c</span>(<span class="st">"700-2000"</span>, <span class="st">"571-640"</span>, <span class="st">"20-30"</span>),</span>
<span id="cb26-121"><a href="#cb26-121" aria-hidden="true" tabindex="-1"></a>  <span class="at">Low         =</span> <span class="fu">c</span>(<span class="st">"2000-5000"</span>, <span class="st">"514-571"</span>, <span class="st">"30-45"</span>),</span>
<span id="cb26-122"><a href="#cb26-122" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">Very Low</span><span class="st">`</span>  <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"&gt;5000"</span>, <span class="st">"&lt;513.8"</span>, <span class="st">"&gt;45"</span>),</span>
<span id="cb26-123"><a href="#cb26-123" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">Weights</span><span class="st">`</span>   <span class="ot">=</span> <span class="fu">c</span>(<span class="fl">2.5</span>, <span class="dv">4</span>, <span class="fl">3.5</span>)</span>
<span id="cb26-124"><a href="#cb26-124" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb26-125"><a href="#cb26-125" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-126"><a href="#cb26-126" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualizing the table with kable</span></span>
<span id="cb26-127"><a href="#cb26-127" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(data, <span class="at">align =</span> <span class="st">"c"</span>)</span>
<span id="cb26-128"><a href="#cb26-128" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-129"><a href="#cb26-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-130"><a href="#cb26-130" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval=FALSE, other_data}</span></span>
<span id="cb26-131"><a href="#cb26-131" aria-hidden="true" tabindex="-1"></a><span class="co"># Read data and crop to Pasorapa</span></span>
<span id="cb26-132"><a href="#cb26-132" aria-hidden="true" tabindex="-1"></a><span class="co"># read data </span></span>
<span id="cb26-133"><a href="#cb26-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-134"><a href="#cb26-134" aria-hidden="true" tabindex="-1"></a><span class="do">## shapes</span></span>
<span id="cb26-135"><a href="#cb26-135" aria-hidden="true" tabindex="-1"></a><span class="co"># veg   &lt;- read_sf("veg_nv_bol_geo.shp") # Vegetation</span></span>
<span id="cb26-136"><a href="#cb26-136" aria-hidden="true" tabindex="-1"></a><span class="co"># geo   &lt;- read_sf("Geologia.shp") # Geografia</span></span>
<span id="cb26-137"><a href="#cb26-137" aria-hidden="true" tabindex="-1"></a><span class="co"># geo   &lt;- read_sf("geologia.shp", crs = 4326)   # Geografia</span></span>
<span id="cb26-138"><a href="#cb26-138" aria-hidden="true" tabindex="-1"></a><span class="co"># dsmw  &lt;- read_sf("DSMW.shp", crs = 4326)</span></span>
<span id="cb26-139"><a href="#cb26-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-140"><a href="#cb26-140" aria-hidden="true" tabindex="-1"></a><span class="co"># other kind of vegetation</span></span>
<span id="cb26-141"><a href="#cb26-141" aria-hidden="true" tabindex="-1"></a><span class="co"># se_bo_geo &lt;- read_sf("se_bo_geo.shp")</span></span>
<span id="cb26-142"><a href="#cb26-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-143"><a href="#cb26-143" aria-hidden="true" tabindex="-1"></a><span class="co"># temperatur min</span></span>
<span id="cb26-144"><a href="#cb26-144" aria-hidden="true" tabindex="-1"></a><span class="co"># tmin01 &lt;- rast("wc2.1_30s_tmin_01.tif")</span></span>
<span id="cb26-145"><a href="#cb26-145" aria-hidden="true" tabindex="-1"></a><span class="co"># tmin02 &lt;- rast("wc2.1_30s_tmin_02.tif")</span></span>
<span id="cb26-146"><a href="#cb26-146" aria-hidden="true" tabindex="-1"></a><span class="co"># tmin03 &lt;- rast("wc2.1_30s_tmin_03.tif")</span></span>
<span id="cb26-147"><a href="#cb26-147" aria-hidden="true" tabindex="-1"></a><span class="co"># tmin04 &lt;- rast("wc2.1_30s_tmin_04.tif")</span></span>
<span id="cb26-148"><a href="#cb26-148" aria-hidden="true" tabindex="-1"></a><span class="co"># tmin05 &lt;- rast("wc2.1_30s_tmin_05.tif")</span></span>
<span id="cb26-149"><a href="#cb26-149" aria-hidden="true" tabindex="-1"></a><span class="co"># tmin06 &lt;- rast("wc2.1_30s_tmin_06.tif")</span></span>
<span id="cb26-150"><a href="#cb26-150" aria-hidden="true" tabindex="-1"></a><span class="co"># tmin07 &lt;- rast("wc2.1_30s_tmin_07.tif")</span></span>
<span id="cb26-151"><a href="#cb26-151" aria-hidden="true" tabindex="-1"></a><span class="co"># tmin08 &lt;- rast("wc2.1_30s_tmin_08.tif")</span></span>
<span id="cb26-152"><a href="#cb26-152" aria-hidden="true" tabindex="-1"></a><span class="co"># tmin09 &lt;- rast("wc2.1_30s_tmin_09.tif")</span></span>
<span id="cb26-153"><a href="#cb26-153" aria-hidden="true" tabindex="-1"></a><span class="co"># tmin10 &lt;- rast("wc2.1_30s_tmin_10.tif")</span></span>
<span id="cb26-154"><a href="#cb26-154" aria-hidden="true" tabindex="-1"></a><span class="co"># tmin11 &lt;- rast("wc2.1_30s_tmin_11.tif")</span></span>
<span id="cb26-155"><a href="#cb26-155" aria-hidden="true" tabindex="-1"></a><span class="co"># tmin12 &lt;- rast("wc2.1_30s_tmin_12.tif")</span></span>
<span id="cb26-156"><a href="#cb26-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-157"><a href="#cb26-157" aria-hidden="true" tabindex="-1"></a><span class="co"># temperatur max</span></span>
<span id="cb26-158"><a href="#cb26-158" aria-hidden="true" tabindex="-1"></a><span class="co"># tmax01 &lt;- rast("wc2.1_30s_tmax_01.tif")</span></span>
<span id="cb26-159"><a href="#cb26-159" aria-hidden="true" tabindex="-1"></a><span class="co"># tmax02 &lt;- rast("wc2.1_30s_tmax_02.tif")</span></span>
<span id="cb26-160"><a href="#cb26-160" aria-hidden="true" tabindex="-1"></a><span class="co"># tmax03 &lt;- rast("wc2.1_30s_tmax_03.tif")</span></span>
<span id="cb26-161"><a href="#cb26-161" aria-hidden="true" tabindex="-1"></a><span class="co"># tmax04 &lt;- rast("wc2.1_30s_tmax_04.tif")</span></span>
<span id="cb26-162"><a href="#cb26-162" aria-hidden="true" tabindex="-1"></a><span class="co"># tmax05 &lt;- rast("wc2.1_30s_tmax_05.tif")</span></span>
<span id="cb26-163"><a href="#cb26-163" aria-hidden="true" tabindex="-1"></a><span class="co"># tmax06 &lt;- rast("wc2.1_30s_tmax_06.tif")</span></span>
<span id="cb26-164"><a href="#cb26-164" aria-hidden="true" tabindex="-1"></a><span class="co"># tmax07 &lt;- rast("wc2.1_30s_tmax_07.tif")</span></span>
<span id="cb26-165"><a href="#cb26-165" aria-hidden="true" tabindex="-1"></a><span class="co"># tmax08 &lt;- rast("wc2.1_30s_tmax_08.tif")</span></span>
<span id="cb26-166"><a href="#cb26-166" aria-hidden="true" tabindex="-1"></a><span class="co"># tmax09 &lt;- rast("wc2.1_30s_tmax_09.tif")</span></span>
<span id="cb26-167"><a href="#cb26-167" aria-hidden="true" tabindex="-1"></a><span class="co"># tmax10 &lt;- rast("wc2.1_30s_tmax_10.tif")</span></span>
<span id="cb26-168"><a href="#cb26-168" aria-hidden="true" tabindex="-1"></a><span class="co"># tmax11 &lt;- rast("wc2.1_30s_tmax_11.tif")</span></span>
<span id="cb26-169"><a href="#cb26-169" aria-hidden="true" tabindex="-1"></a><span class="co"># tmax12 &lt;- rast("wc2.1_30s_tmax_12.tif")</span></span>
<span id="cb26-170"><a href="#cb26-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-171"><a href="#cb26-171" aria-hidden="true" tabindex="-1"></a><span class="co"># precipitacion</span></span>
<span id="cb26-172"><a href="#cb26-172" aria-hidden="true" tabindex="-1"></a><span class="co"># precip01 &lt;- rast("wc2.1_30s_prec_01.tif")</span></span>
<span id="cb26-173"><a href="#cb26-173" aria-hidden="true" tabindex="-1"></a><span class="co"># precip02 &lt;- rast("wc2.1_30s_prec_02.tif")</span></span>
<span id="cb26-174"><a href="#cb26-174" aria-hidden="true" tabindex="-1"></a><span class="co"># precip03 &lt;- rast("wc2.1_30s_prec_03.tif")</span></span>
<span id="cb26-175"><a href="#cb26-175" aria-hidden="true" tabindex="-1"></a><span class="co"># precip04 &lt;- rast("wc2.1_30s_prec_04.tif")</span></span>
<span id="cb26-176"><a href="#cb26-176" aria-hidden="true" tabindex="-1"></a><span class="co"># precip05 &lt;- rast("wc2.1_30s_prec_05.tif")</span></span>
<span id="cb26-177"><a href="#cb26-177" aria-hidden="true" tabindex="-1"></a><span class="co"># precip06 &lt;- rast("wc2.1_30s_prec_06.tif")</span></span>
<span id="cb26-178"><a href="#cb26-178" aria-hidden="true" tabindex="-1"></a><span class="co"># precip07 &lt;- rast("wc2.1_30s_prec_07.tif")</span></span>
<span id="cb26-179"><a href="#cb26-179" aria-hidden="true" tabindex="-1"></a><span class="co"># precip08 &lt;- rast("wc2.1_30s_prec_08.tif")</span></span>
<span id="cb26-180"><a href="#cb26-180" aria-hidden="true" tabindex="-1"></a><span class="co"># precip09 &lt;- rast("wc2.1_30s_prec_09.tif")</span></span>
<span id="cb26-181"><a href="#cb26-181" aria-hidden="true" tabindex="-1"></a><span class="co"># precip10 &lt;- rast("wc2.1_30s_prec_10.tif")</span></span>
<span id="cb26-182"><a href="#cb26-182" aria-hidden="true" tabindex="-1"></a><span class="co"># precip11 &lt;- rast("wc2.1_30s_prec_11.tif")</span></span>
<span id="cb26-183"><a href="#cb26-183" aria-hidden="true" tabindex="-1"></a><span class="co"># precip12 &lt;- rast("wc2.1_30s_prec_12.tif")</span></span>
<span id="cb26-184"><a href="#cb26-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-185"><a href="#cb26-185" aria-hidden="true" tabindex="-1"></a><span class="do">## Satellite Data</span></span>
<span id="cb26-186"><a href="#cb26-186" aria-hidden="true" tabindex="-1"></a><span class="co"># sat_full &lt;- rast("sat_full.tiff")</span></span>
<span id="cb26-187"><a href="#cb26-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-188"><a href="#cb26-188" aria-hidden="true" tabindex="-1"></a><span class="co"># Land Use</span></span>
<span id="cb26-189"><a href="#cb26-189" aria-hidden="true" tabindex="-1"></a><span class="co"># land &lt;- rast("Change_10S_070W.tif")</span></span>
<span id="cb26-190"><a href="#cb26-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-191"><a href="#cb26-191" aria-hidden="true" tabindex="-1"></a><span class="co"># print(land, vp = grid::viewport(0.8, 0.185, width = 0.2, height = 0.45))</span></span>
<span id="cb26-192"><a href="#cb26-192" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-193"><a href="#cb26-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-194"><a href="#cb26-194" aria-hidden="true" tabindex="-1"></a><span class="in">```{r Processing}</span></span>
<span id="cb26-195"><a href="#cb26-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-196"><a href="#cb26-196" aria-hidden="true" tabindex="-1"></a><span class="co"># River Data</span></span>
<span id="cb26-197"><a href="#cb26-197" aria-hidden="true" tabindex="-1"></a><span class="do">##  200 meters Buffer River data</span></span>
<span id="cb26-198"><a href="#cb26-198" aria-hidden="true" tabindex="-1"></a>buffer_river <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_buffer</span>(Pasorapa, <span class="dv">200</span>)</span>
<span id="cb26-199"><a href="#cb26-199" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-200"><a href="#cb26-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-201"><a href="#cb26-201" aria-hidden="true" tabindex="-1"></a><span class="fu">### River Data</span></span>
<span id="cb26-202"><a href="#cb26-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-203"><a href="#cb26-203" aria-hidden="true" tabindex="-1"></a>The data utilized aimed to estimate the distance to rivers, serving as a proxy for assessing the likelihood of drought occurrences. The underlying assumption was that greater distances from rivers correspond to increased drought probabilities. To calculate distances, the **`terra::distance`** function was employed on the river shapefiles associated with various municipalities. Detailed processing steps are outlined in the subsequent chapter of the <span class="co">[</span><span class="ot">Appendix</span><span class="co">](#sec-sec-river)</span>.</span>
<span id="cb26-204"><a href="#cb26-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-205"><a href="#cb26-205" aria-hidden="true" tabindex="-1"></a>The reclassification has been calculated according to @tbl-data-weights-def. Defining the classification values @Gao2023 has been using different values in order to classify and evaluate drought exposure, hazard factors, vulnerability, and mitigation capacity.</span>
<span id="cb26-206"><a href="#cb26-206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-207"><a href="#cb26-207" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval=FALSE}</span></span>
<span id="cb26-208"><a href="#cb26-208" aria-hidden="true" tabindex="-1"></a>river_crop <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(<span class="st">"river_crop.shp"</span>)</span>
<span id="cb26-209"><a href="#cb26-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-210"><a href="#cb26-210" aria-hidden="true" tabindex="-1"></a>buffer_river <span class="ot">&lt;-</span> <span class="fu">st_buffer</span>(river_crop, <span class="dv">100</span>)</span>
<span id="cb26-211"><a href="#cb26-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-212"><a href="#cb26-212" aria-hidden="true" tabindex="-1"></a><span class="co"># Create an empty raster to rasterize into</span></span>
<span id="cb26-213"><a href="#cb26-213" aria-hidden="true" tabindex="-1"></a>empty_raster <span class="ot">&lt;-</span> <span class="fu">raster</span>(<span class="fu">extent</span>(buffer_river), <span class="at">resolution =</span> <span class="fu">c</span>(<span class="fl">0.0008333333</span>, <span class="fl">0.0008333333</span>))</span>
<span id="cb26-214"><a href="#cb26-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-215"><a href="#cb26-215" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Rasterize</span></span>
<span id="cb26-216"><a href="#cb26-216" aria-hidden="true" tabindex="-1"></a>river_raster <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rasterize</span>(buffer_river, empty_raster, <span class="at">field =</span> <span class="st">"CATCH_SKM"</span>)</span>
<span id="cb26-217"><a href="#cb26-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-218"><a href="#cb26-218" aria-hidden="true" tabindex="-1"></a><span class="co"># , background = 0</span></span>
<span id="cb26-219"><a href="#cb26-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-220"><a href="#cb26-220" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calc into %</span></span>
<span id="cb26-221"><a href="#cb26-221" aria-hidden="true" tabindex="-1"></a>river_raster <span class="ot">&lt;-</span> (river_raster <span class="sc">/</span> <span class="dv">100</span>)</span>
<span id="cb26-222"><a href="#cb26-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-223"><a href="#cb26-223" aria-hidden="true" tabindex="-1"></a><span class="co"># River</span></span>
<span id="cb26-224"><a href="#cb26-224" aria-hidden="true" tabindex="-1"></a><span class="do">##  crop and mask dem</span></span>
<span id="cb26-225"><a href="#cb26-225" aria-hidden="true" tabindex="-1"></a>river_crop <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">crop</span>(river_raster, Pasorapa)</span>
<span id="cb26-226"><a href="#cb26-226" aria-hidden="true" tabindex="-1"></a>river_mask <span class="ot">&lt;-</span> <span class="fu">mask</span>(river_crop, Pasorapa)</span>
<span id="cb26-227"><a href="#cb26-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-228"><a href="#cb26-228" aria-hidden="true" tabindex="-1"></a><span class="co"># plot(river_mask)</span></span>
<span id="cb26-229"><a href="#cb26-229" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-230"><a href="#cb26-230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-231"><a href="#cb26-231" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval=FALSE}</span></span>
<span id="cb26-232"><a href="#cb26-232" aria-hidden="true" tabindex="-1"></a><span class="co"># Define a common CRS for all your rasters</span></span>
<span id="cb26-233"><a href="#cb26-233" aria-hidden="true" tabindex="-1"></a>common_crs <span class="ot">&lt;-</span> <span class="st">"+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0"</span></span>
<span id="cb26-234"><a href="#cb26-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-235"><a href="#cb26-235" aria-hidden="true" tabindex="-1"></a><span class="co"># Assign the CRS to each raster</span></span>
<span id="cb26-236"><a href="#cb26-236" aria-hidden="true" tabindex="-1"></a><span class="fu">crs</span>(river_raster) <span class="ot">&lt;-</span> <span class="fu">crs</span>(river_subset_sp) <span class="ot">&lt;-</span> common_crs</span>
<span id="cb26-237"><a href="#cb26-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-238"><a href="#cb26-238" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate distances on the subset</span></span>
<span id="cb26-239"><a href="#cb26-239" aria-hidden="true" tabindex="-1"></a>dist_to_river <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">distance</span>(river_mask)</span>
<span id="cb26-240"><a href="#cb26-240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-241"><a href="#cb26-241" aria-hidden="true" tabindex="-1"></a><span class="co"># writeRaster(dist_to_river, "dist_to_river_pasorapa.tif")</span></span>
<span id="cb26-242"><a href="#cb26-242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-243"><a href="#cb26-243" aria-hidden="true" tabindex="-1"></a>dist_to_river <span class="ot">&lt;-</span> <span class="fu">rast</span>(<span class="st">"dist_to_river_pasorapa.tif"</span>)</span>
<span id="cb26-244"><a href="#cb26-244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-245"><a href="#cb26-245" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the distances raster</span></span>
<span id="cb26-246"><a href="#cb26-246" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dist_to_river)</span>
<span id="cb26-247"><a href="#cb26-247" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-248"><a href="#cb26-248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-251"><a href="#cb26-251" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb26-252"><a href="#cb26-252" aria-hidden="true" tabindex="-1"></a><span class="co"># Define areas of interest</span></span>
<span id="cb26-253"><a href="#cb26-253" aria-hidden="true" tabindex="-1"></a>areas <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb26-254"><a href="#cb26-254" aria-hidden="true" tabindex="-1"></a>  <span class="at">pasorapa =</span> Pasorapa,</span>
<span id="cb26-255"><a href="#cb26-255" aria-hidden="true" tabindex="-1"></a>  <span class="at">aiquile =</span> Aiquile,</span>
<span id="cb26-256"><a href="#cb26-256" aria-hidden="true" tabindex="-1"></a>  <span class="at">totora =</span> totora,</span>
<span id="cb26-257"><a href="#cb26-257" aria-hidden="true" tabindex="-1"></a>  <span class="at">pojo =</span> pojo</span>
<span id="cb26-258"><a href="#cb26-258" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb26-259"><a href="#cb26-259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-260"><a href="#cb26-260" aria-hidden="true" tabindex="-1"></a><span class="co"># Define river distance raster files</span></span>
<span id="cb26-261"><a href="#cb26-261" aria-hidden="true" tabindex="-1"></a>river_rasters <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb26-262"><a href="#cb26-262" aria-hidden="true" tabindex="-1"></a>  <span class="at">pasorapa =</span> <span class="st">"dist_to_river_pasorapa.tif"</span>,</span>
<span id="cb26-263"><a href="#cb26-263" aria-hidden="true" tabindex="-1"></a>  <span class="at">aiquile  =</span> <span class="st">"dist_to_river_aiquile.tif"</span>,</span>
<span id="cb26-264"><a href="#cb26-264" aria-hidden="true" tabindex="-1"></a>  <span class="at">totora   =</span> <span class="st">"dist_to_river_totora.tif"</span>,</span>
<span id="cb26-265"><a href="#cb26-265" aria-hidden="true" tabindex="-1"></a>  <span class="at">pojo     =</span> <span class="st">"dist_to_river_pojo.tif"</span></span>
<span id="cb26-266"><a href="#cb26-266" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb26-267"><a href="#cb26-267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-268"><a href="#cb26-268" aria-hidden="true" tabindex="-1"></a><span class="co"># reclass</span></span>
<span id="cb26-269"><a href="#cb26-269" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a tibble with the reclassification table</span></span>
<span id="cb26-270"><a href="#cb26-270" aria-hidden="true" tabindex="-1"></a>reclass_table_river <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb26-271"><a href="#cb26-271" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span>from, <span class="sc">~</span>to, <span class="sc">~</span>becomes,</span>
<span id="cb26-272"><a href="#cb26-272" aria-hidden="true" tabindex="-1"></a>  <span class="dv">5000</span>,    <span class="cn">Inf</span>,  <span class="dv">0</span>,     </span>
<span id="cb26-273"><a href="#cb26-273" aria-hidden="true" tabindex="-1"></a>  <span class="dv">2000</span>,    <span class="dv">5000</span>,  <span class="fl">0.25</span>,  </span>
<span id="cb26-274"><a href="#cb26-274" aria-hidden="true" tabindex="-1"></a>  <span class="dv">700</span>,    <span class="dv">2000</span>,  <span class="fl">0.5</span>,    </span>
<span id="cb26-275"><a href="#cb26-275" aria-hidden="true" tabindex="-1"></a>  <span class="dv">200</span>,    <span class="dv">700</span>,  <span class="fl">0.75</span>,   </span>
<span id="cb26-276"><a href="#cb26-276" aria-hidden="true" tabindex="-1"></a>  <span class="sc">-</span><span class="cn">Inf</span>,   <span class="dv">200</span>,  <span class="dv">1</span>       </span>
<span id="cb26-277"><a href="#cb26-277" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb26-278"><a href="#cb26-278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-279"><a href="#cb26-279" aria-hidden="true" tabindex="-1"></a><span class="co"># Common CRS for all rasters</span></span>
<span id="cb26-280"><a href="#cb26-280" aria-hidden="true" tabindex="-1"></a>common_crs <span class="ot">&lt;-</span> <span class="st">"+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0"</span></span>
<span id="cb26-281"><a href="#cb26-281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-282"><a href="#cb26-282" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop through areas of interest</span></span>
<span id="cb26-283"><a href="#cb26-283" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (area_name <span class="cf">in</span> <span class="fu">names</span>(areas)) {</span>
<span id="cb26-284"><a href="#cb26-284" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Load river distance raster</span></span>
<span id="cb26-285"><a href="#cb26-285" aria-hidden="true" tabindex="-1"></a>  dist_to_river <span class="ot">&lt;-</span> <span class="fu">rast</span>(river_rasters[[area_name]])</span>
<span id="cb26-286"><a href="#cb26-286" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-287"><a href="#cb26-287" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Assign common CRS</span></span>
<span id="cb26-288"><a href="#cb26-288" aria-hidden="true" tabindex="-1"></a>  <span class="fu">crs</span>(dist_to_river) <span class="ot">&lt;-</span> common_crs</span>
<span id="cb26-289"><a href="#cb26-289" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_crs</span>(areas[[area_name]]) <span class="ot">&lt;-</span> common_crs</span>
<span id="cb26-290"><a href="#cb26-290" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-291"><a href="#cb26-291" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Crop and mask river distance raster</span></span>
<span id="cb26-292"><a href="#cb26-292" aria-hidden="true" tabindex="-1"></a>  river_crop <span class="ot">&lt;-</span> <span class="fu">crop</span>(dist_to_river, areas[[area_name]])</span>
<span id="cb26-293"><a href="#cb26-293" aria-hidden="true" tabindex="-1"></a>  river_mask <span class="ot">&lt;-</span> <span class="fu">mask</span>(river_crop, areas[[area_name]])</span>
<span id="cb26-294"><a href="#cb26-294" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-295"><a href="#cb26-295" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Reclassify the river distance raster</span></span>
<span id="cb26-296"><a href="#cb26-296" aria-hidden="true" tabindex="-1"></a>  river_reclassified <span class="ot">&lt;-</span> <span class="fu">classify</span>(river_mask, reclass_table_river, <span class="at">include.lowest =</span> <span class="cn">TRUE</span>, <span class="at">right =</span> <span class="cn">TRUE</span>)</span>
<span id="cb26-297"><a href="#cb26-297" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-298"><a href="#cb26-298" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Assign to appropriate variable</span></span>
<span id="cb26-299"><a href="#cb26-299" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(<span class="fu">paste0</span>(<span class="st">"river_reclassified_"</span>, area_name), river_reclassified)</span>
<span id="cb26-300"><a href="#cb26-300" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb26-301"><a href="#cb26-301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-302"><a href="#cb26-302" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-303"><a href="#cb26-303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-304"><a href="#cb26-304" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval=FALSE}</span></span>
<span id="cb26-305"><a href="#cb26-305" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-river-distance-Pasorapa</span></span>
<span id="cb26-306"><a href="#cb26-306" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "Reclassification table of the River-Distance Data"</span></span>
<span id="cb26-307"><a href="#cb26-307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-308"><a href="#cb26-308" aria-hidden="true" tabindex="-1"></a><span class="co"># write / safe Raster</span></span>
<span id="cb26-309"><a href="#cb26-309" aria-hidden="true" tabindex="-1"></a><span class="co"># writeRaster(dist_to_river, "dist_to_river_pasorapa.tif")</span></span>
<span id="cb26-310"><a href="#cb26-310" aria-hidden="true" tabindex="-1"></a>dist_to_river <span class="ot">&lt;-</span> <span class="fu">rast</span>(<span class="st">"dist_to_river_pasorapa.tif"</span>)</span>
<span id="cb26-311"><a href="#cb26-311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-312"><a href="#cb26-312" aria-hidden="true" tabindex="-1"></a><span class="co"># River</span></span>
<span id="cb26-313"><a href="#cb26-313" aria-hidden="true" tabindex="-1"></a><span class="do">##  crop and mask dem</span></span>
<span id="cb26-314"><a href="#cb26-314" aria-hidden="true" tabindex="-1"></a>river_crop <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">crop</span>(dist_to_river, Pasorapa)</span>
<span id="cb26-315"><a href="#cb26-315" aria-hidden="true" tabindex="-1"></a>river_mask <span class="ot">&lt;-</span> <span class="fu">mask</span>(river_crop, Pasorapa)</span>
<span id="cb26-316"><a href="#cb26-316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-317"><a href="#cb26-317" aria-hidden="true" tabindex="-1"></a><span class="co"># reclass</span></span>
<span id="cb26-318"><a href="#cb26-318" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a tibble with the reclassification table</span></span>
<span id="cb26-319"><a href="#cb26-319" aria-hidden="true" tabindex="-1"></a>reclass_table_river <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb26-320"><a href="#cb26-320" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span>from, <span class="sc">~</span>to, <span class="sc">~</span>becomes,</span>
<span id="cb26-321"><a href="#cb26-321" aria-hidden="true" tabindex="-1"></a>  <span class="dv">5000</span>,    <span class="cn">Inf</span>,  <span class="dv">0</span>,     </span>
<span id="cb26-322"><a href="#cb26-322" aria-hidden="true" tabindex="-1"></a>  <span class="dv">2000</span>,    <span class="dv">5000</span>,  <span class="fl">0.25</span>,  </span>
<span id="cb26-323"><a href="#cb26-323" aria-hidden="true" tabindex="-1"></a>  <span class="dv">700</span>,    <span class="dv">2000</span>,  <span class="fl">0.5</span>,    </span>
<span id="cb26-324"><a href="#cb26-324" aria-hidden="true" tabindex="-1"></a>  <span class="dv">200</span>,    <span class="dv">700</span>,  <span class="fl">0.75</span>,   </span>
<span id="cb26-325"><a href="#cb26-325" aria-hidden="true" tabindex="-1"></a>  <span class="sc">-</span><span class="cn">Inf</span>,   <span class="dv">200</span>,  <span class="dv">1</span>       </span>
<span id="cb26-326"><a href="#cb26-326" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb26-327"><a href="#cb26-327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-328"><a href="#cb26-328" aria-hidden="true" tabindex="-1"></a><span class="co"># Reclassify the slope raster based on the reclassification table</span></span>
<span id="cb26-329"><a href="#cb26-329" aria-hidden="true" tabindex="-1"></a>river_reclassified_pasorapa <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">classify</span>(river_mask, reclass_table_river, <span class="at">include.lowest =</span> <span class="cn">TRUE</span>, <span class="at">right =</span> <span class="cn">TRUE</span>)</span>
<span id="cb26-330"><a href="#cb26-330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-331"><a href="#cb26-331" aria-hidden="true" tabindex="-1"></a><span class="co"># kable(reclass_table_river)</span></span>
<span id="cb26-332"><a href="#cb26-332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-333"><a href="#cb26-333" aria-hidden="true" tabindex="-1"></a><span class="co"># write/ safe Raster</span></span>
<span id="cb26-334"><a href="#cb26-334" aria-hidden="true" tabindex="-1"></a>dist_to_river <span class="ot">&lt;-</span> <span class="fu">rast</span>(<span class="st">"dist_to_river_aiquile.tif"</span>)</span>
<span id="cb26-335"><a href="#cb26-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-336"><a href="#cb26-336" aria-hidden="true" tabindex="-1"></a>common_crs <span class="ot">&lt;-</span> <span class="st">"+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0"</span></span>
<span id="cb26-337"><a href="#cb26-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-338"><a href="#cb26-338" aria-hidden="true" tabindex="-1"></a><span class="co"># Assign the CRS to each raster</span></span>
<span id="cb26-339"><a href="#cb26-339" aria-hidden="true" tabindex="-1"></a><span class="fu">crs</span>(dist_to_river) <span class="ot">&lt;-</span> common_crs</span>
<span id="cb26-340"><a href="#cb26-340" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(Aiquile)    <span class="ot">&lt;-</span> common_crs</span>
<span id="cb26-341"><a href="#cb26-341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-342"><a href="#cb26-342" aria-hidden="true" tabindex="-1"></a><span class="co"># River</span></span>
<span id="cb26-343"><a href="#cb26-343" aria-hidden="true" tabindex="-1"></a><span class="do">##  crop and mask dem</span></span>
<span id="cb26-344"><a href="#cb26-344" aria-hidden="true" tabindex="-1"></a>river_crop <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">crop</span>(dist_to_river, Aiquile)</span>
<span id="cb26-345"><a href="#cb26-345" aria-hidden="true" tabindex="-1"></a>river_mask <span class="ot">&lt;-</span> <span class="fu">mask</span>(river_crop, Aiquile)</span>
<span id="cb26-346"><a href="#cb26-346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-347"><a href="#cb26-347" aria-hidden="true" tabindex="-1"></a><span class="co"># Reclassify the slope raster based on the reclassification table</span></span>
<span id="cb26-348"><a href="#cb26-348" aria-hidden="true" tabindex="-1"></a>river_reclassified_aiquile <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">classify</span>(river_mask, reclass_table_river, <span class="at">include.lowest =</span> <span class="cn">TRUE</span>, <span class="at">right =</span> <span class="cn">TRUE</span>)</span>
<span id="cb26-349"><a href="#cb26-349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-350"><a href="#cb26-350" aria-hidden="true" tabindex="-1"></a><span class="co"># pojo</span></span>
<span id="cb26-351"><a href="#cb26-351" aria-hidden="true" tabindex="-1"></a>dist_to_river_pojo   <span class="ot">&lt;-</span> <span class="fu">rast</span>(<span class="st">"dist_to_river_pojo.tif"</span>)</span>
<span id="cb26-352"><a href="#cb26-352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-353"><a href="#cb26-353" aria-hidden="true" tabindex="-1"></a>river_reclassified_pojo <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">classify</span>(dist_to_river_pojo, reclass_table_river, <span class="at">include.lowest =</span> <span class="cn">TRUE</span>, <span class="at">right =</span> <span class="cn">TRUE</span>)</span>
<span id="cb26-354"><a href="#cb26-354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-355"><a href="#cb26-355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-356"><a href="#cb26-356" aria-hidden="true" tabindex="-1"></a><span class="co"># totora</span></span>
<span id="cb26-357"><a href="#cb26-357" aria-hidden="true" tabindex="-1"></a>dist_to_river_totora <span class="ot">&lt;-</span> <span class="fu">rast</span>(<span class="st">"dist_to_river_totora.tif"</span>)</span>
<span id="cb26-358"><a href="#cb26-358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-359"><a href="#cb26-359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-360"><a href="#cb26-360" aria-hidden="true" tabindex="-1"></a>river_reclassified_totora <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">classify</span>(dist_to_river_totora, reclass_table_river, <span class="at">include.lowest =</span> <span class="cn">TRUE</span>, <span class="at">right =</span> <span class="cn">TRUE</span>)</span>
<span id="cb26-361"><a href="#cb26-361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-362"><a href="#cb26-362" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-363"><a href="#cb26-363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-366"><a href="#cb26-366" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb26-367"><a href="#cb26-367" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-river</span></span>
<span id="cb26-368"><a href="#cb26-368" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Reclassification River Distance"</span></span>
<span id="cb26-369"><a href="#cb26-369" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 5</span></span>
<span id="cb26-370"><a href="#cb26-370" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 5</span></span>
<span id="cb26-371"><a href="#cb26-371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-372"><a href="#cb26-372" aria-hidden="true" tabindex="-1"></a><span class="co"># change name</span></span>
<span id="cb26-373"><a href="#cb26-373" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(river_reclassified_pasorapa) <span class="ot">&lt;-</span> <span class="st">"Flood Risk"</span></span>
<span id="cb26-374"><a href="#cb26-374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-375"><a href="#cb26-375" aria-hidden="true" tabindex="-1"></a><span class="co"># Color Palette in R</span></span>
<span id="cb26-376"><a href="#cb26-376" aria-hidden="true" tabindex="-1"></a>colors   <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"darkgreen"</span>,<span class="st">"lightgreen"</span>,<span class="st">"yellow"</span>, <span class="st">"orange"</span>,<span class="st">"red"</span>)</span>
<span id="cb26-377"><a href="#cb26-377" aria-hidden="true" tabindex="-1"></a>colors_1 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"lightgreen"</span>,<span class="st">"yellow"</span>, <span class="st">"orange"</span>,<span class="st">"red"</span>)</span>
<span id="cb26-378"><a href="#cb26-378" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb26-379"><a href="#cb26-379" aria-hidden="true" tabindex="-1"></a><span class="co"># # Define the reclassification table</span></span>
<span id="cb26-380"><a href="#cb26-380" aria-hidden="true" tabindex="-1"></a><span class="co"># reclass_table_modify &lt;- tribble(</span></span>
<span id="cb26-381"><a href="#cb26-381" aria-hidden="true" tabindex="-1"></a><span class="co">#   ~from, ~to, ~becomes,</span></span>
<span id="cb26-382"><a href="#cb26-382" aria-hidden="true" tabindex="-1"></a><span class="co">#   0, 0, 0.25  # Reclassify 0 to 0.25</span></span>
<span id="cb26-383"><a href="#cb26-383" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span>
<span id="cb26-384"><a href="#cb26-384" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb26-385"><a href="#cb26-385" aria-hidden="true" tabindex="-1"></a><span class="co"># # Reclassify the river_reclassified_pasorapa raster</span></span>
<span id="cb26-386"><a href="#cb26-386" aria-hidden="true" tabindex="-1"></a><span class="co"># river_reclassified_pasorapa &lt;- classify(river_reclassified_pasorapa, reclass_table_modify, include.lowest = TRUE, right = TRUE)</span></span>
<span id="cb26-387"><a href="#cb26-387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-388"><a href="#cb26-388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-389"><a href="#cb26-389" aria-hidden="true" tabindex="-1"></a><span class="co"># view</span></span>
<span id="cb26-390"><a href="#cb26-390" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">"plot"</span>)</span>
<span id="cb26-391"><a href="#cb26-391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-392"><a href="#cb26-392" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(all_municipalities) <span class="sc">+</span></span>
<span id="cb26-393"><a href="#cb26-393" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>() <span class="sc">+</span></span>
<span id="cb26-394"><a href="#cb26-394" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(river_reclassified_pasorapa) <span class="sc">+</span></span>
<span id="cb26-395"><a href="#cb26-395" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_raster</span>(<span class="at">palette =</span> colors) <span class="sc">+</span> </span>
<span id="cb26-396"><a href="#cb26-396" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(river_reclassified_aiquile) <span class="sc">+</span></span>
<span id="cb26-397"><a href="#cb26-397" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_raster</span>(<span class="at">legend.show =</span> <span class="cn">FALSE</span>, <span class="at">palette =</span> colors) <span class="sc">+</span>  </span>
<span id="cb26-398"><a href="#cb26-398" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(river_reclassified_totora) <span class="sc">+</span></span>
<span id="cb26-399"><a href="#cb26-399" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_raster</span>(<span class="at">legend.show =</span> <span class="cn">FALSE</span>, <span class="at">palette =</span> colors) <span class="sc">+</span>  </span>
<span id="cb26-400"><a href="#cb26-400" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(river_reclassified_pojo) <span class="sc">+</span></span>
<span id="cb26-401"><a href="#cb26-401" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_raster</span>(<span class="at">legend.show =</span> <span class="cn">FALSE</span>, <span class="at">palette =</span> colors_1) <span class="sc">+</span>  </span>
<span id="cb26-402"><a href="#cb26-402" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(all_municipalities) <span class="sc">+</span></span>
<span id="cb26-403"><a href="#cb26-403" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tm_borders</span>(<span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb26-404"><a href="#cb26-404" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tm_layout</span>(<span class="at">frame =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb26-405"><a href="#cb26-405" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_text</span>(<span class="st">"NAME_3"</span>, <span class="at">size =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb26-406"><a href="#cb26-406" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tm_scale_bar</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">10</span>), <span class="at">text.size =</span> <span class="fl">0.9</span>, <span class="at">position =</span> <span class="fu">c</span>(<span class="st">"left"</span>)) <span class="sc">+</span>  </span>
<span id="cb26-407"><a href="#cb26-407" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_compass</span>(<span class="at">type =</span> <span class="st">"4star"</span>, <span class="at">size =</span> <span class="dv">6</span>, <span class="at">position =</span> <span class="fu">c</span>(<span class="st">"right"</span>, <span class="st">"top"</span>)) <span class="sc">+</span></span>
<span id="cb26-408"><a href="#cb26-408" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_credits</span>(<span class="st">"Author: Johannes Quente"</span>, <span class="at">fontface =</span> <span class="st">"italic"</span>, <span class="at">align =</span> <span class="st">"right"</span>) <span class="sc">+</span></span>
<span id="cb26-409"><a href="#cb26-409" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_graticules</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb26-410"><a href="#cb26-410" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(</span>
<span id="cb26-411"><a href="#cb26-411" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text.size =</span> <span class="dv">1</span>,</span>
<span id="cb26-412"><a href="#cb26-412" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="st">"left"</span>, <span class="st">"bottom"</span>),</span>
<span id="cb26-413"><a href="#cb26-413" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.outside =</span> <span class="cn">TRUE</span></span>
<span id="cb26-414"><a href="#cb26-414" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb26-415"><a href="#cb26-415" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-416"><a href="#cb26-416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-417"><a href="#cb26-417" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval=FALSE, Downstream_loop}</span></span>
<span id="cb26-418"><a href="#cb26-418" aria-hidden="true" tabindex="-1"></a><span class="do">### Downstream loop calc.</span></span>
<span id="cb26-419"><a href="#cb26-419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-420"><a href="#cb26-420" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to find all downstream rivers for a given river ID</span></span>
<span id="cb26-421"><a href="#cb26-421" aria-hidden="true" tabindex="-1"></a>find_downstream     <span class="ot">&lt;-</span> <span class="cf">function</span>(start_id, data) {</span>
<span id="cb26-422"><a href="#cb26-422" aria-hidden="true" tabindex="-1"></a>  downstream_rivers <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">mode =</span> <span class="st">"numeric"</span>)</span>
<span id="cb26-423"><a href="#cb26-423" aria-hidden="true" tabindex="-1"></a>  current_id        <span class="ot">&lt;-</span> start_id</span>
<span id="cb26-424"><a href="#cb26-424" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-425"><a href="#cb26-425" aria-hidden="true" tabindex="-1"></a>  <span class="cf">while</span> (<span class="sc">!</span><span class="fu">is.na</span>(current_id)) {</span>
<span id="cb26-426"><a href="#cb26-426" aria-hidden="true" tabindex="-1"></a>    downstream_rivers <span class="ot">&lt;-</span> <span class="fu">c</span>(downstream_rivers, current_id)</span>
<span id="cb26-427"><a href="#cb26-427" aria-hidden="true" tabindex="-1"></a>    current_id <span class="ot">&lt;-</span> data[data<span class="sc">$</span>river_id <span class="sc">==</span> current_id, <span class="st">"NEXT_DOWN"</span>]</span>
<span id="cb26-428"><a href="#cb26-428" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb26-429"><a href="#cb26-429" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-430"><a href="#cb26-430" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(downstream_rivers)</span>
<span id="cb26-431"><a href="#cb26-431" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb26-432"><a href="#cb26-432" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-433"><a href="#cb26-433" aria-hidden="true" tabindex="-1"></a><span class="co"># Usage: Replace 'start_id' with your initial river ID</span></span>
<span id="cb26-434"><a href="#cb26-434" aria-hidden="true" tabindex="-1"></a>start_id <span class="ot">&lt;-</span> <span class="dv">61259906</span></span>
<span id="cb26-435"><a href="#cb26-435" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">find_downstream</span>(start_id, river_crop)</span>
<span id="cb26-436"><a href="#cb26-436" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(result)</span>
<span id="cb26-437"><a href="#cb26-437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-438"><a href="#cb26-438" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-439"><a href="#cb26-439" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-440"><a href="#cb26-440" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval= FALSE}</span></span>
<span id="cb26-441"><a href="#cb26-441" aria-hidden="true" tabindex="-1"></a><span class="do">### terra::distance calc.</span></span>
<span id="cb26-442"><a href="#cb26-442" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-443"><a href="#cb26-443" aria-hidden="true" tabindex="-1"></a>river_crop <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(<span class="st">"river_crop.shp"</span>)</span>
<span id="cb26-444"><a href="#cb26-444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-445"><a href="#cb26-445" aria-hidden="true" tabindex="-1"></a>buffer_river <span class="ot">&lt;-</span> <span class="fu">st_buffer</span>(river_crop, <span class="dv">100</span>)</span>
<span id="cb26-446"><a href="#cb26-446" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-447"><a href="#cb26-447" aria-hidden="true" tabindex="-1"></a><span class="co"># Create an empty raster to rasterize into</span></span>
<span id="cb26-448"><a href="#cb26-448" aria-hidden="true" tabindex="-1"></a>empty_raster <span class="ot">&lt;-</span> <span class="fu">raster</span>(<span class="fu">extent</span>(buffer_river), <span class="at">resolution =</span> <span class="fu">c</span>(<span class="fl">0.0008333333</span>, <span class="fl">0.0008333333</span>))</span>
<span id="cb26-449"><a href="#cb26-449" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-450"><a href="#cb26-450" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Rasterize</span></span>
<span id="cb26-451"><a href="#cb26-451" aria-hidden="true" tabindex="-1"></a>river_raster <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rasterize</span>(buffer_river, empty_raster, <span class="at">field =</span> <span class="st">"CATCH_SKM"</span>, <span class="at">background =</span> <span class="dv">0</span>)</span>
<span id="cb26-452"><a href="#cb26-452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-453"><a href="#cb26-453" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calc into %</span></span>
<span id="cb26-454"><a href="#cb26-454" aria-hidden="true" tabindex="-1"></a>river_raster <span class="ot">&lt;-</span> (river_raster <span class="sc">/</span> <span class="dv">100</span>)</span>
<span id="cb26-455"><a href="#cb26-455" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-456"><a href="#cb26-456" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(river_raster)</span>
<span id="cb26-457"><a href="#cb26-457" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-458"><a href="#cb26-458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-459"><a href="#cb26-459" aria-hidden="true" tabindex="-1"></a>\newpage</span>
<span id="cb26-460"><a href="#cb26-460" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-461"><a href="#cb26-461" aria-hidden="true" tabindex="-1"></a><span class="fu">### Precipitation Data</span></span>
<span id="cb26-462"><a href="#cb26-462" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-463"><a href="#cb26-463" aria-hidden="true" tabindex="-1"></a>The following Data provided by @fick2017worldclim resembles Precipitation Data on a 30 Arc Second Accuracy. The format provides one Raster-Layer for each month.</span>
<span id="cb26-464"><a href="#cb26-464" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-465"><a href="#cb26-465" aria-hidden="true" tabindex="-1"></a>Twelve raster layers have been aggregated to generate a unified raster layer, facilitating subsequent classification. The outcome is a comprehensive raster layer encompassing the total precipitation for the average year spanning from 1970 to 2000. The utilized code is available in the <span class="co">[</span><span class="ot">Appendix</span><span class="co">](#sec-sec-precip)</span> In the reclassification process, values were partitioned into five equally distributed groups based on frequency, with each group representing 20% of the total data frequency. The distribution and grouping methodology are illustrated in @fig-hist-precip. The reclassification has been calculated according to @tbl-data-weights-def.</span>
<span id="cb26-466"><a href="#cb26-466" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-469"><a href="#cb26-469" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb26-470"><a href="#cb26-470" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-precipitation</span></span>
<span id="cb26-471"><a href="#cb26-471" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "Reclassification table of the Precipitation Data"</span></span>
<span id="cb26-472"><a href="#cb26-472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-473"><a href="#cb26-473" aria-hidden="true" tabindex="-1"></a>precip_pasorapa <span class="ot">&lt;-</span> <span class="fu">rast</span>(<span class="st">"sum_raster_pasorapa.tif"</span>)</span>
<span id="cb26-474"><a href="#cb26-474" aria-hidden="true" tabindex="-1"></a>precip_aiquile  <span class="ot">&lt;-</span> <span class="fu">rast</span>(<span class="st">"sum_raster.tif"</span>)</span>
<span id="cb26-475"><a href="#cb26-475" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-476"><a href="#cb26-476" aria-hidden="true" tabindex="-1"></a>precip_pojo     <span class="ot">&lt;-</span> <span class="fu">rast</span>(<span class="st">"precip_pojo.tif"</span>)</span>
<span id="cb26-477"><a href="#cb26-477" aria-hidden="true" tabindex="-1"></a>precip_totora   <span class="ot">&lt;-</span> <span class="fu">rast</span>(<span class="st">"precip_totora.tif"</span>)</span>
<span id="cb26-478"><a href="#cb26-478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-479"><a href="#cb26-479" aria-hidden="true" tabindex="-1"></a>precip_todos    <span class="ot">&lt;-</span> <span class="fu">rast</span>(<span class="st">"precip_todos.tif"</span>)</span>
<span id="cb26-480"><a href="#cb26-480" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-481"><a href="#cb26-481" aria-hidden="true" tabindex="-1"></a><span class="co"># Reclass</span></span>
<span id="cb26-482"><a href="#cb26-482" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a tibble with the reclassification table</span></span>
<span id="cb26-483"><a href="#cb26-483" aria-hidden="true" tabindex="-1"></a>reclass_table_precip <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb26-484"><a href="#cb26-484" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span>from, <span class="sc">~</span>to, <span class="sc">~</span>becomes,</span>
<span id="cb26-485"><a href="#cb26-485" aria-hidden="true" tabindex="-1"></a>  <span class="fl">1058.2</span>, <span class="cn">Inf</span>,     <span class="dv">1</span>,     </span>
<span id="cb26-486"><a href="#cb26-486" aria-hidden="true" tabindex="-1"></a>  <span class="dv">640</span>,    <span class="fl">1058.2</span>,  <span class="fl">0.75</span>,  </span>
<span id="cb26-487"><a href="#cb26-487" aria-hidden="true" tabindex="-1"></a>  <span class="dv">571</span>,    <span class="dv">640</span>,     <span class="fl">0.5</span>,   </span>
<span id="cb26-488"><a href="#cb26-488" aria-hidden="true" tabindex="-1"></a>  <span class="fl">513.8</span>,  <span class="dv">571</span>,     <span class="fl">0.25</span>,  </span>
<span id="cb26-489"><a href="#cb26-489" aria-hidden="true" tabindex="-1"></a>  <span class="sc">-</span><span class="cn">Inf</span>,   <span class="fl">513.8</span>,   <span class="dv">0</span>      </span>
<span id="cb26-490"><a href="#cb26-490" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb26-491"><a href="#cb26-491" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-492"><a href="#cb26-492" aria-hidden="true" tabindex="-1"></a><span class="co"># Reclassify the slope raster based on the reclassification table</span></span>
<span id="cb26-493"><a href="#cb26-493" aria-hidden="true" tabindex="-1"></a>precip_reclassified_pasorapa <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">classify</span>(precip_pasorapa, reclass_table_precip, <span class="at">include.lowest =</span> <span class="cn">TRUE</span>, <span class="at">right =</span> <span class="cn">TRUE</span>)</span>
<span id="cb26-494"><a href="#cb26-494" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-495"><a href="#cb26-495" aria-hidden="true" tabindex="-1"></a>precip_reclassified_aiquile <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">classify</span>(precip_aiquile, reclass_table_precip, <span class="at">include.lowest =</span> <span class="cn">TRUE</span>, <span class="at">right =</span> <span class="cn">TRUE</span>)</span>
<span id="cb26-496"><a href="#cb26-496" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-497"><a href="#cb26-497" aria-hidden="true" tabindex="-1"></a>precip_reclassified_pojo <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">classify</span>(precip_pojo, reclass_table_precip, <span class="at">include.lowest =</span> <span class="cn">TRUE</span>, <span class="at">right =</span> <span class="cn">TRUE</span>)</span>
<span id="cb26-498"><a href="#cb26-498" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-499"><a href="#cb26-499" aria-hidden="true" tabindex="-1"></a>precip_reclassified_totora <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">classify</span>(precip_totora, reclass_table_precip, <span class="at">include.lowest =</span> <span class="cn">TRUE</span>, <span class="at">right =</span> <span class="cn">TRUE</span>)</span>
<span id="cb26-500"><a href="#cb26-500" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-501"><a href="#cb26-501" aria-hidden="true" tabindex="-1"></a><span class="co"># todos</span></span>
<span id="cb26-502"><a href="#cb26-502" aria-hidden="true" tabindex="-1"></a>precip_reclassified_todos <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">classify</span>(precip_todos, reclass_table_precip, <span class="at">include.lowest =</span> <span class="cn">TRUE</span>, <span class="at">right =</span> <span class="cn">TRUE</span>)</span>
<span id="cb26-503"><a href="#cb26-503" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-504"><a href="#cb26-504" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-507"><a href="#cb26-507" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb26-508"><a href="#cb26-508" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-hist-precip</span></span>
<span id="cb26-509"><a href="#cb26-509" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Distribution of the Precipitation Data"</span></span>
<span id="cb26-510"><a href="#cb26-510" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify the number of breaks (bins)</span></span>
<span id="cb26-511"><a href="#cb26-511" aria-hidden="true" tabindex="-1"></a>num_breaks <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb26-512"><a href="#cb26-512" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-513"><a href="#cb26-513" aria-hidden="true" tabindex="-1"></a>break_values <span class="ot">&lt;-</span> <span class="fu">quantile</span>(<span class="fu">values</span>(precip_todos, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">probs =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">length.out =</span> num_breaks <span class="sc">+</span> <span class="dv">1</span>))</span>
<span id="cb26-514"><a href="#cb26-514" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-515"><a href="#cb26-515" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the histogram with equal-frequency breaks</span></span>
<span id="cb26-516"><a href="#cb26-516" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(<span class="fu">values</span>(precip_todos), <span class="at">breaks =</span> <span class="st">"FD"</span>, <span class="at">main =</span> <span class="st">"Histogram of Data Distribution"</span>, <span class="at">xlab =</span> <span class="st">"Precipitation (mm)"</span>, <span class="at">col =</span> <span class="st">"skyblue"</span>, <span class="at">border =</span> <span class="st">"black"</span>, <span class="at">plot =</span> <span class="cn">TRUE</span>)</span>
<span id="cb26-517"><a href="#cb26-517" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-518"><a href="#cb26-518" aria-hidden="true" tabindex="-1"></a><span class="co"># Add vertical lines to represent the breaks</span></span>
<span id="cb26-519"><a href="#cb26-519" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="fu">quantile</span>(<span class="fu">values</span>(precip_todos, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">probs =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">length.out =</span> num_breaks <span class="sc">+</span> <span class="dv">1</span>)), <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb26-520"><a href="#cb26-520" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-521"><a href="#cb26-521" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-522"><a href="#cb26-522" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-525"><a href="#cb26-525" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb26-526"><a href="#cb26-526" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-precipitation</span></span>
<span id="cb26-527"><a href="#cb26-527" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Reclassification Result of the Precipitation Data"</span></span>
<span id="cb26-528"><a href="#cb26-528" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 5</span></span>
<span id="cb26-529"><a href="#cb26-529" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 5</span></span>
<span id="cb26-530"><a href="#cb26-530" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-531"><a href="#cb26-531" aria-hidden="true" tabindex="-1"></a>colors   <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"darkgreen"</span>,<span class="st">"lightgreen"</span>,<span class="st">"yellow"</span>, <span class="st">"orange"</span>,<span class="st">"red"</span>)</span>
<span id="cb26-532"><a href="#cb26-532" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-533"><a href="#cb26-533" aria-hidden="true" tabindex="-1"></a><span class="co"># change name</span></span>
<span id="cb26-534"><a href="#cb26-534" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(precip_reclassified_todos) <span class="ot">&lt;-</span> <span class="st">"Flood Risk"</span></span>
<span id="cb26-535"><a href="#cb26-535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-536"><a href="#cb26-536" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(all_municipalities) <span class="sc">+</span></span>
<span id="cb26-537"><a href="#cb26-537" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>() <span class="sc">+</span></span>
<span id="cb26-538"><a href="#cb26-538" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(precip_reclassified_todos) <span class="sc">+</span></span>
<span id="cb26-539"><a href="#cb26-539" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_raster</span>(<span class="at">palette =</span> colors) <span class="sc">+</span> </span>
<span id="cb26-540"><a href="#cb26-540" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(all_municipalities) <span class="sc">+</span></span>
<span id="cb26-541"><a href="#cb26-541" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tm_borders</span>(<span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb26-542"><a href="#cb26-542" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tm_layout</span>(<span class="at">frame =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb26-543"><a href="#cb26-543" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_text</span>(<span class="st">"NAME_3"</span>, <span class="at">size =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb26-544"><a href="#cb26-544" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tm_scale_bar</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">10</span>), <span class="at">text.size =</span> <span class="fl">0.9</span>, <span class="at">position =</span> <span class="fu">c</span>(<span class="st">"left"</span>)) <span class="sc">+</span>  </span>
<span id="cb26-545"><a href="#cb26-545" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_compass</span>(<span class="at">type =</span> <span class="st">"4star"</span>, <span class="at">size =</span> <span class="dv">6</span>, <span class="at">position =</span> <span class="fu">c</span>(<span class="st">"right"</span>, <span class="st">"top"</span>)) <span class="sc">+</span></span>
<span id="cb26-546"><a href="#cb26-546" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_credits</span>(<span class="st">"Author: Johannes Quente"</span>, <span class="at">fontface =</span> <span class="st">"italic"</span>, <span class="at">align =</span> <span class="st">"right"</span>) <span class="sc">+</span></span>
<span id="cb26-547"><a href="#cb26-547" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_graticules</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb26-548"><a href="#cb26-548" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(</span>
<span id="cb26-549"><a href="#cb26-549" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text.size =</span> <span class="dv">1</span>,</span>
<span id="cb26-550"><a href="#cb26-550" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="st">"left"</span>, <span class="st">"bottom"</span>),</span>
<span id="cb26-551"><a href="#cb26-551" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.outside =</span> <span class="cn">TRUE</span></span>
<span id="cb26-552"><a href="#cb26-552" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb26-553"><a href="#cb26-553" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-554"><a href="#cb26-554" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-555"><a href="#cb26-555" aria-hidden="true" tabindex="-1"></a>\newpage</span>
<span id="cb26-556"><a href="#cb26-556" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-557"><a href="#cb26-557" aria-hidden="true" tabindex="-1"></a><span class="fu">### DEM (Inclination) Data</span></span>
<span id="cb26-558"><a href="#cb26-558" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-559"><a href="#cb26-559" aria-hidden="true" tabindex="-1"></a>The provided Digital Elevation Model (DEM) consists of raster values showcasing variations in altitudes. These altitude values where converted into slope data using the <span class="in">`terra::terrain`</span> -function from the Terra package. The reclassification has been calculated according to @tbl-data-weights-def.</span>
<span id="cb26-560"><a href="#cb26-560" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-561"><a href="#cb26-561" aria-hidden="true" tabindex="-1"></a>Subsequently, the slope data was categorized into varying degrees of possibility of Flood in percent based on their inclination. For a detailed view of the reclassification code, please refer to the <span class="co">[</span><span class="ot">Appendix</span><span class="co">](#sec-sec-inclination)</span>.</span>
<span id="cb26-562"><a href="#cb26-562" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-563"><a href="#cb26-563" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval=FALSE}</span></span>
<span id="cb26-564"><a href="#cb26-564" aria-hidden="true" tabindex="-1"></a><span class="co"># read data</span></span>
<span id="cb26-565"><a href="#cb26-565" aria-hidden="true" tabindex="-1"></a><span class="co"># Totora</span></span>
<span id="cb26-566"><a href="#cb26-566" aria-hidden="true" tabindex="-1"></a>dem_reclassified_totora  <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"dem_reclassified_totora.rds"</span>)</span>
<span id="cb26-567"><a href="#cb26-567" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-568"><a href="#cb26-568" aria-hidden="true" tabindex="-1"></a><span class="co"># Aiquile</span></span>
<span id="cb26-569"><a href="#cb26-569" aria-hidden="true" tabindex="-1"></a>dem_reclassified_aiquile <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"dem_reclassified_aiquile.rds"</span>)</span>
<span id="cb26-570"><a href="#cb26-570" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-571"><a href="#cb26-571" aria-hidden="true" tabindex="-1"></a><span class="co"># Pasorapa</span></span>
<span id="cb26-572"><a href="#cb26-572" aria-hidden="true" tabindex="-1"></a>dem_reclassified_pasorapa <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"dem_reclassified_pasorapa.rds"</span>)</span>
<span id="cb26-573"><a href="#cb26-573" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-574"><a href="#cb26-574" aria-hidden="true" tabindex="-1"></a><span class="co"># Pojo</span></span>
<span id="cb26-575"><a href="#cb26-575" aria-hidden="true" tabindex="-1"></a>dem_reclassified_pojo    <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"dem_reclassified_pojo.rds"</span>)</span>
<span id="cb26-576"><a href="#cb26-576" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-577"><a href="#cb26-577" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-578"><a href="#cb26-578" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval=FALSE}</span></span>
<span id="cb26-579"><a href="#cb26-579" aria-hidden="true" tabindex="-1"></a><span class="co"># DEM Pasorapa</span></span>
<span id="cb26-580"><a href="#cb26-580" aria-hidden="true" tabindex="-1"></a><span class="do">##  crop and mask dem</span></span>
<span id="cb26-581"><a href="#cb26-581" aria-hidden="true" tabindex="-1"></a>dem_crop <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">crop</span>(dem, Pasorapa)</span>
<span id="cb26-582"><a href="#cb26-582" aria-hidden="true" tabindex="-1"></a>dem_mask_pasorapa <span class="ot">&lt;-</span> <span class="fu">mask</span>(dem_crop, Pasorapa)</span>
<span id="cb26-583"><a href="#cb26-583" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-584"><a href="#cb26-584" aria-hidden="true" tabindex="-1"></a>terrain_pasorapa <span class="ot">&lt;-</span> <span class="fu">terrain</span>(dem_mask_pasorapa)</span>
<span id="cb26-585"><a href="#cb26-585" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-586"><a href="#cb26-586" aria-hidden="true" tabindex="-1"></a><span class="co"># DEM Aiquile</span></span>
<span id="cb26-587"><a href="#cb26-587" aria-hidden="true" tabindex="-1"></a><span class="do">##  crop and mask dem</span></span>
<span id="cb26-588"><a href="#cb26-588" aria-hidden="true" tabindex="-1"></a>dem_crop <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">crop</span>(dem, Aiquile)</span>
<span id="cb26-589"><a href="#cb26-589" aria-hidden="true" tabindex="-1"></a>dem_mask_Aiquile <span class="ot">&lt;-</span> <span class="fu">mask</span>(dem_crop, Aiquile)</span>
<span id="cb26-590"><a href="#cb26-590" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-591"><a href="#cb26-591" aria-hidden="true" tabindex="-1"></a>terrain_dem_mask_Aiquile <span class="ot">&lt;-</span> <span class="fu">terrain</span>(dem_mask_Aiquile)</span>
<span id="cb26-592"><a href="#cb26-592" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-593"><a href="#cb26-593" aria-hidden="true" tabindex="-1"></a><span class="co"># DEM Totora</span></span>
<span id="cb26-594"><a href="#cb26-594" aria-hidden="true" tabindex="-1"></a><span class="do">##  crop and mask dem</span></span>
<span id="cb26-595"><a href="#cb26-595" aria-hidden="true" tabindex="-1"></a>dem_crop <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">crop</span>(dem, totora)</span>
<span id="cb26-596"><a href="#cb26-596" aria-hidden="true" tabindex="-1"></a>dem_mask_totora <span class="ot">&lt;-</span> <span class="fu">mask</span>(dem_crop, totora)</span>
<span id="cb26-597"><a href="#cb26-597" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-598"><a href="#cb26-598" aria-hidden="true" tabindex="-1"></a>terrain_totora <span class="ot">&lt;-</span> <span class="fu">terrain</span>(dem_mask_totora)</span>
<span id="cb26-599"><a href="#cb26-599" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-600"><a href="#cb26-600" aria-hidden="true" tabindex="-1"></a><span class="co"># DEM Pojo</span></span>
<span id="cb26-601"><a href="#cb26-601" aria-hidden="true" tabindex="-1"></a><span class="do">##  crop and mask dem</span></span>
<span id="cb26-602"><a href="#cb26-602" aria-hidden="true" tabindex="-1"></a>dem_crop <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">crop</span>(dem, pojo)</span>
<span id="cb26-603"><a href="#cb26-603" aria-hidden="true" tabindex="-1"></a>dem_mask_pojo <span class="ot">&lt;-</span> <span class="fu">mask</span>(dem_crop, pojo)</span>
<span id="cb26-604"><a href="#cb26-604" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-605"><a href="#cb26-605" aria-hidden="true" tabindex="-1"></a>terrain_pojo <span class="ot">&lt;-</span> <span class="fu">terrain</span>(dem_mask_pojo)</span>
<span id="cb26-606"><a href="#cb26-606" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-607"><a href="#cb26-607" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a tibble with the reclassification table</span></span>
<span id="cb26-608"><a href="#cb26-608" aria-hidden="true" tabindex="-1"></a>reclass_table_dem <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb26-609"><a href="#cb26-609" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span>from, <span class="sc">~</span>to, <span class="sc">~</span>becomes,</span>
<span id="cb26-610"><a href="#cb26-610" aria-hidden="true" tabindex="-1"></a>  <span class="dv">0</span>, <span class="dv">10</span>, <span class="dv">1</span>,           <span class="co"># 0-10: Plano</span></span>
<span id="cb26-611"><a href="#cb26-611" aria-hidden="true" tabindex="-1"></a>  <span class="dv">10</span>, <span class="dv">20</span>, <span class="fl">0.56</span>,           <span class="co"># 10-20: Mod. inclinado</span></span>
<span id="cb26-612"><a href="#cb26-612" aria-hidden="true" tabindex="-1"></a>  <span class="dv">20</span>, <span class="dv">30</span>, <span class="fl">0.34</span>,          <span class="co"># 20-30: Inclinado</span></span>
<span id="cb26-613"><a href="#cb26-613" aria-hidden="true" tabindex="-1"></a>  <span class="dv">30</span>, <span class="dv">45</span>, <span class="fl">0.2</span>,          <span class="co"># 30-45: Mod. empinado</span></span>
<span id="cb26-614"><a href="#cb26-614" aria-hidden="true" tabindex="-1"></a>  <span class="dv">45</span>, <span class="cn">Inf</span>,<span class="fl">0.09</span>            <span class="co"># 45 and above: Fuert. empinado</span></span>
<span id="cb26-615"><a href="#cb26-615" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb26-616"><a href="#cb26-616" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-617"><a href="#cb26-617" aria-hidden="true" tabindex="-1"></a><span class="co"># Assuming you have a slope raster 'slope_raster'</span></span>
<span id="cb26-618"><a href="#cb26-618" aria-hidden="true" tabindex="-1"></a><span class="co"># Reclassify the slope raster based on the reclassification table</span></span>
<span id="cb26-619"><a href="#cb26-619" aria-hidden="true" tabindex="-1"></a>dem_reclassified_pasorapa <span class="ot">&lt;-</span> <span class="fu">classify</span>(terrain_pasorapa, reclass_table_dem, <span class="at">include.lowest =</span> <span class="cn">TRUE</span>, <span class="at">right =</span> <span class="cn">TRUE</span>)</span>
<span id="cb26-620"><a href="#cb26-620" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-621"><a href="#cb26-621" aria-hidden="true" tabindex="-1"></a>dem_reclassified_aiquile <span class="ot">&lt;-</span> <span class="fu">classify</span>(terrain_aiquile, reclass_table_dem, <span class="at">include.lowest =</span> <span class="cn">TRUE</span>, <span class="at">right =</span> <span class="cn">TRUE</span>)</span>
<span id="cb26-622"><a href="#cb26-622" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-623"><a href="#cb26-623" aria-hidden="true" tabindex="-1"></a>dem_reclassified_totora <span class="ot">&lt;-</span> <span class="fu">classify</span>(terrain_totora, reclass_table_dem, <span class="at">include.lowest =</span> <span class="cn">TRUE</span>, <span class="at">right =</span> <span class="cn">TRUE</span>)</span>
<span id="cb26-624"><a href="#cb26-624" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-625"><a href="#cb26-625" aria-hidden="true" tabindex="-1"></a>dem_reclassified_pojo <span class="ot">&lt;-</span> <span class="fu">classify</span>(terrain_pojo, reclass_table_dem, <span class="at">include.lowest =</span> <span class="cn">TRUE</span>, <span class="at">right =</span> <span class="cn">TRUE</span>)</span>
<span id="cb26-626"><a href="#cb26-626" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-627"><a href="#cb26-627" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-630"><a href="#cb26-630" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb26-631"><a href="#cb26-631" aria-hidden="true" tabindex="-1"></a><span class="co"># Define areas of interest</span></span>
<span id="cb26-632"><a href="#cb26-632" aria-hidden="true" tabindex="-1"></a>areas <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb26-633"><a href="#cb26-633" aria-hidden="true" tabindex="-1"></a>  <span class="at">pasorapa =</span> Pasorapa,</span>
<span id="cb26-634"><a href="#cb26-634" aria-hidden="true" tabindex="-1"></a>  <span class="at">aiquile =</span> Aiquile,</span>
<span id="cb26-635"><a href="#cb26-635" aria-hidden="true" tabindex="-1"></a>  <span class="at">totora =</span> totora,</span>
<span id="cb26-636"><a href="#cb26-636" aria-hidden="true" tabindex="-1"></a>  <span class="at">pojo =</span> pojo</span>
<span id="cb26-637"><a href="#cb26-637" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb26-638"><a href="#cb26-638" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-639"><a href="#cb26-639" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a tibble with the reclassification table</span></span>
<span id="cb26-640"><a href="#cb26-640" aria-hidden="true" tabindex="-1"></a>reclass_table_dem <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb26-641"><a href="#cb26-641" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span>from, <span class="sc">~</span>to, <span class="sc">~</span>becomes,</span>
<span id="cb26-642"><a href="#cb26-642" aria-hidden="true" tabindex="-1"></a>  <span class="dv">0</span>, <span class="dv">10</span>, <span class="dv">1</span>,           <span class="co"># 0-10: Plano</span></span>
<span id="cb26-643"><a href="#cb26-643" aria-hidden="true" tabindex="-1"></a>  <span class="dv">10</span>, <span class="dv">20</span>, <span class="fl">0.56</span>,       <span class="co"># 10-20: Mod. inclinado</span></span>
<span id="cb26-644"><a href="#cb26-644" aria-hidden="true" tabindex="-1"></a>  <span class="dv">20</span>, <span class="dv">30</span>, <span class="fl">0.34</span>,       <span class="co"># 20-30: Inclinado</span></span>
<span id="cb26-645"><a href="#cb26-645" aria-hidden="true" tabindex="-1"></a>  <span class="dv">30</span>, <span class="dv">45</span>, <span class="fl">0.2</span>,        <span class="co"># 30-45: Mod. empinado</span></span>
<span id="cb26-646"><a href="#cb26-646" aria-hidden="true" tabindex="-1"></a>  <span class="dv">45</span>, <span class="cn">Inf</span>,<span class="fl">0.09</span>        <span class="co"># 45 and above: Fuert. empinado</span></span>
<span id="cb26-647"><a href="#cb26-647" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb26-648"><a href="#cb26-648" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-649"><a href="#cb26-649" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop through areas of interest</span></span>
<span id="cb26-650"><a href="#cb26-650" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (area_name <span class="cf">in</span> <span class="fu">names</span>(areas)) {</span>
<span id="cb26-651"><a href="#cb26-651" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Crop and mask dem</span></span>
<span id="cb26-652"><a href="#cb26-652" aria-hidden="true" tabindex="-1"></a>  dem_crop <span class="ot">&lt;-</span> <span class="fu">crop</span>(dem, areas[[area_name]])</span>
<span id="cb26-653"><a href="#cb26-653" aria-hidden="true" tabindex="-1"></a>  dem_mask <span class="ot">&lt;-</span> <span class="fu">mask</span>(dem_crop, areas[[area_name]])</span>
<span id="cb26-654"><a href="#cb26-654" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-655"><a href="#cb26-655" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate terrain</span></span>
<span id="cb26-656"><a href="#cb26-656" aria-hidden="true" tabindex="-1"></a>  terrain <span class="ot">&lt;-</span> <span class="fu">terrain</span>(dem_mask)</span>
<span id="cb26-657"><a href="#cb26-657" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-658"><a href="#cb26-658" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Reclassify DEM</span></span>
<span id="cb26-659"><a href="#cb26-659" aria-hidden="true" tabindex="-1"></a>  dem_reclassified <span class="ot">&lt;-</span> <span class="fu">classify</span>(terrain, reclass_table_dem, <span class="at">include.lowest =</span> <span class="cn">TRUE</span>, <span class="at">right =</span> <span class="cn">TRUE</span>)</span>
<span id="cb26-660"><a href="#cb26-660" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-661"><a href="#cb26-661" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Assign to appropriate variable</span></span>
<span id="cb26-662"><a href="#cb26-662" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(<span class="fu">paste0</span>(<span class="st">"dem_reclassified_"</span>, area_name), dem_reclassified)</span>
<span id="cb26-663"><a href="#cb26-663" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb26-664"><a href="#cb26-664" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-665"><a href="#cb26-665" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-668"><a href="#cb26-668" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb26-669"><a href="#cb26-669" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-dem-inclination</span></span>
<span id="cb26-670"><a href="#cb26-670" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Reclassification of DEM derived Inclination"</span></span>
<span id="cb26-671"><a href="#cb26-671" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 5</span></span>
<span id="cb26-672"><a href="#cb26-672" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 5</span></span>
<span id="cb26-673"><a href="#cb26-673" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-674"><a href="#cb26-674" aria-hidden="true" tabindex="-1"></a><span class="co"># change name</span></span>
<span id="cb26-675"><a href="#cb26-675" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(dem_reclassified_aiquile) <span class="ot">&lt;-</span> <span class="st">"Flood Risk"</span></span>
<span id="cb26-676"><a href="#cb26-676" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-677"><a href="#cb26-677" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-678"><a href="#cb26-678" aria-hidden="true" tabindex="-1"></a><span class="co"># view</span></span>
<span id="cb26-679"><a href="#cb26-679" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">"plot"</span>)</span>
<span id="cb26-680"><a href="#cb26-680" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-681"><a href="#cb26-681" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(all_municipalities) <span class="sc">+</span></span>
<span id="cb26-682"><a href="#cb26-682" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>() <span class="sc">+</span></span>
<span id="cb26-683"><a href="#cb26-683" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(dem_reclassified_aiquile) <span class="sc">+</span></span>
<span id="cb26-684"><a href="#cb26-684" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_raster</span>(<span class="at">palette =</span> colors) <span class="sc">+</span> </span>
<span id="cb26-685"><a href="#cb26-685" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(dem_reclassified_pasorapa) <span class="sc">+</span></span>
<span id="cb26-686"><a href="#cb26-686" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_raster</span>(<span class="at">legend.show =</span> <span class="cn">FALSE</span>, <span class="at">palette =</span> colors) <span class="sc">+</span>  </span>
<span id="cb26-687"><a href="#cb26-687" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(dem_reclassified_pojo) <span class="sc">+</span></span>
<span id="cb26-688"><a href="#cb26-688" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_raster</span>(<span class="at">legend.show =</span> <span class="cn">FALSE</span>, <span class="at">palette =</span> colors) <span class="sc">+</span>  </span>
<span id="cb26-689"><a href="#cb26-689" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(dem_reclassified_totora) <span class="sc">+</span></span>
<span id="cb26-690"><a href="#cb26-690" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_raster</span>(<span class="at">legend.show =</span> <span class="cn">FALSE</span>, <span class="at">palette =</span> colors) <span class="sc">+</span>  </span>
<span id="cb26-691"><a href="#cb26-691" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(all_municipalities) <span class="sc">+</span></span>
<span id="cb26-692"><a href="#cb26-692" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tm_borders</span>(<span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb26-693"><a href="#cb26-693" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tm_layout</span>(<span class="at">frame =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb26-694"><a href="#cb26-694" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_text</span>(<span class="st">"NAME_3"</span>, <span class="at">size =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb26-695"><a href="#cb26-695" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tm_scale_bar</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">10</span>), <span class="at">text.size =</span> <span class="fl">0.9</span>, <span class="at">position =</span> <span class="fu">c</span>(<span class="st">"left"</span>)) <span class="sc">+</span>  </span>
<span id="cb26-696"><a href="#cb26-696" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_compass</span>(<span class="at">type =</span> <span class="st">"4star"</span>, <span class="at">size =</span> <span class="dv">6</span>, <span class="at">position =</span> <span class="fu">c</span>(<span class="st">"right"</span>, <span class="st">"top"</span>)) <span class="sc">+</span></span>
<span id="cb26-697"><a href="#cb26-697" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_credits</span>(<span class="st">"Author: Johannes Quente"</span>, <span class="at">fontface =</span> <span class="st">"italic"</span>, <span class="at">align =</span> <span class="st">"right"</span>) <span class="sc">+</span></span>
<span id="cb26-698"><a href="#cb26-698" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_graticules</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb26-699"><a href="#cb26-699" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(</span>
<span id="cb26-700"><a href="#cb26-700" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text.size =</span> <span class="dv">1</span>,</span>
<span id="cb26-701"><a href="#cb26-701" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="st">"left"</span>, <span class="st">"bottom"</span>),</span>
<span id="cb26-702"><a href="#cb26-702" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.outside =</span> <span class="cn">TRUE</span></span>
<span id="cb26-703"><a href="#cb26-703" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb26-704"><a href="#cb26-704" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-705"><a href="#cb26-705" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-706"><a href="#cb26-706" aria-hidden="true" tabindex="-1"></a>\newpage</span>
<span id="cb26-707"><a href="#cb26-707" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-708"><a href="#cb26-708" aria-hidden="true" tabindex="-1"></a><span class="fu">## Results Flood Risk</span></span>
<span id="cb26-709"><a href="#cb26-709" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-712"><a href="#cb26-712" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb26-713"><a href="#cb26-713" aria-hidden="true" tabindex="-1"></a><span class="do">### Aiquile</span></span>
<span id="cb26-714"><a href="#cb26-714" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-715"><a href="#cb26-715" aria-hidden="true" tabindex="-1"></a><span class="co"># Resample aspect raster to match the extent and resolution of min_temp_pasorapa_reclassified</span></span>
<span id="cb26-716"><a href="#cb26-716" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-717"><a href="#cb26-717" aria-hidden="true" tabindex="-1"></a>precip_reclassified <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">resample</span>(precip_reclassified_aiquile, dem_reclassified_aiquile)</span>
<span id="cb26-718"><a href="#cb26-718" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-719"><a href="#cb26-719" aria-hidden="true" tabindex="-1"></a>river_reclassified <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">resample</span>(river_reclassified_aiquile, precip_reclassified)</span>
<span id="cb26-720"><a href="#cb26-720" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-721"><a href="#cb26-721" aria-hidden="true" tabindex="-1"></a><span class="co"># Adjusted weights</span></span>
<span id="cb26-722"><a href="#cb26-722" aria-hidden="true" tabindex="-1"></a>weight_river    <span class="ot">&lt;-</span> <span class="fl">0.25</span></span>
<span id="cb26-723"><a href="#cb26-723" aria-hidden="true" tabindex="-1"></a>weight_dem      <span class="ot">&lt;-</span> <span class="fl">0.35</span></span>
<span id="cb26-724"><a href="#cb26-724" aria-hidden="true" tabindex="-1"></a>weight_precip   <span class="ot">&lt;-</span> <span class="fl">0.4</span></span>
<span id="cb26-725"><a href="#cb26-725" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-726"><a href="#cb26-726" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform the adjusted weighted combination</span></span>
<span id="cb26-727"><a href="#cb26-727" aria-hidden="true" tabindex="-1"></a>final_raster <span class="ot">&lt;-</span> weight_river    <span class="sc">*</span> river_reclassified <span class="sc">+</span></span>
<span id="cb26-728"><a href="#cb26-728" aria-hidden="true" tabindex="-1"></a>                weight_precip   <span class="sc">*</span> precip_reclassified <span class="sc">+</span></span>
<span id="cb26-729"><a href="#cb26-729" aria-hidden="true" tabindex="-1"></a>                weight_dem      <span class="sc">*</span> dem_reclassified_aiquile</span>
<span id="cb26-730"><a href="#cb26-730" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-731"><a href="#cb26-731" aria-hidden="true" tabindex="-1"></a>final_raster_aiquile <span class="ot">&lt;-</span> final_raster</span>
<span id="cb26-732"><a href="#cb26-732" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-733"><a href="#cb26-733" aria-hidden="true" tabindex="-1"></a><span class="do">### Pojo</span></span>
<span id="cb26-734"><a href="#cb26-734" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-735"><a href="#cb26-735" aria-hidden="true" tabindex="-1"></a><span class="co"># Resample aspect raster to match the extent and resolution of min_temp_pasorapa_reclassified</span></span>
<span id="cb26-736"><a href="#cb26-736" aria-hidden="true" tabindex="-1"></a>precip_reclassified <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">resample</span>(precip_reclassified_pojo, dem_reclassified_pojo)</span>
<span id="cb26-737"><a href="#cb26-737" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-738"><a href="#cb26-738" aria-hidden="true" tabindex="-1"></a>river_reclassified <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">resample</span>(river_reclassified_pojo, precip_reclassified)</span>
<span id="cb26-739"><a href="#cb26-739" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-740"><a href="#cb26-740" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform the adjusted weighted combination</span></span>
<span id="cb26-741"><a href="#cb26-741" aria-hidden="true" tabindex="-1"></a>final_raster <span class="ot">&lt;-</span> weight_river    <span class="sc">*</span> river_reclassified <span class="sc">+</span></span>
<span id="cb26-742"><a href="#cb26-742" aria-hidden="true" tabindex="-1"></a>                weight_precip   <span class="sc">*</span> precip_reclassified <span class="sc">+</span></span>
<span id="cb26-743"><a href="#cb26-743" aria-hidden="true" tabindex="-1"></a>                weight_dem      <span class="sc">*</span> dem_reclassified_pojo</span>
<span id="cb26-744"><a href="#cb26-744" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-745"><a href="#cb26-745" aria-hidden="true" tabindex="-1"></a>final_raster_pojo <span class="ot">&lt;-</span> final_raster</span>
<span id="cb26-746"><a href="#cb26-746" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-747"><a href="#cb26-747" aria-hidden="true" tabindex="-1"></a><span class="do">### Pasorapa</span></span>
<span id="cb26-748"><a href="#cb26-748" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-749"><a href="#cb26-749" aria-hidden="true" tabindex="-1"></a><span class="co"># Resample aspect raster to match the extent and resolution of min_temp_pasorapa_reclassified</span></span>
<span id="cb26-750"><a href="#cb26-750" aria-hidden="true" tabindex="-1"></a>precip_reclassified <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">resample</span>(precip_reclassified_pasorapa, dem_reclassified_pasorapa)</span>
<span id="cb26-751"><a href="#cb26-751" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-752"><a href="#cb26-752" aria-hidden="true" tabindex="-1"></a>river_reclassified <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">resample</span>(river_reclassified_pasorapa, precip_reclassified)</span>
<span id="cb26-753"><a href="#cb26-753" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-754"><a href="#cb26-754" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform the adjusted weighted combination</span></span>
<span id="cb26-755"><a href="#cb26-755" aria-hidden="true" tabindex="-1"></a>final_raster <span class="ot">&lt;-</span> weight_river    <span class="sc">*</span> river_reclassified <span class="sc">+</span></span>
<span id="cb26-756"><a href="#cb26-756" aria-hidden="true" tabindex="-1"></a>                weight_precip   <span class="sc">*</span> precip_reclassified <span class="sc">+</span></span>
<span id="cb26-757"><a href="#cb26-757" aria-hidden="true" tabindex="-1"></a>                weight_dem      <span class="sc">*</span> dem_reclassified_pasorapa</span>
<span id="cb26-758"><a href="#cb26-758" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-759"><a href="#cb26-759" aria-hidden="true" tabindex="-1"></a>final_raster_pasorapa <span class="ot">&lt;-</span> final_raster</span>
<span id="cb26-760"><a href="#cb26-760" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-761"><a href="#cb26-761" aria-hidden="true" tabindex="-1"></a><span class="do">### Totora</span></span>
<span id="cb26-762"><a href="#cb26-762" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-763"><a href="#cb26-763" aria-hidden="true" tabindex="-1"></a><span class="co"># Resample aspect raster to match the extent and resolution of min_temp_pasorapa_reclassified</span></span>
<span id="cb26-764"><a href="#cb26-764" aria-hidden="true" tabindex="-1"></a>precip_reclassified <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">resample</span>(precip_reclassified_totora, dem_reclassified_totora)</span>
<span id="cb26-765"><a href="#cb26-765" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-766"><a href="#cb26-766" aria-hidden="true" tabindex="-1"></a>river_reclassified <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">resample</span>(river_reclassified_totora, precip_reclassified)</span>
<span id="cb26-767"><a href="#cb26-767" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-768"><a href="#cb26-768" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform the adjusted weighted combination</span></span>
<span id="cb26-769"><a href="#cb26-769" aria-hidden="true" tabindex="-1"></a>final_raster <span class="ot">&lt;-</span> weight_river    <span class="sc">*</span> river_reclassified <span class="sc">+</span></span>
<span id="cb26-770"><a href="#cb26-770" aria-hidden="true" tabindex="-1"></a>                weight_precip   <span class="sc">*</span> precip_reclassified <span class="sc">+</span></span>
<span id="cb26-771"><a href="#cb26-771" aria-hidden="true" tabindex="-1"></a>                weight_dem      <span class="sc">*</span> dem_reclassified_totora</span>
<span id="cb26-772"><a href="#cb26-772" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-773"><a href="#cb26-773" aria-hidden="true" tabindex="-1"></a>final_raster_totora <span class="ot">&lt;-</span> final_raster</span>
<span id="cb26-774"><a href="#cb26-774" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-775"><a href="#cb26-775" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-778"><a href="#cb26-778" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb26-779"><a href="#cb26-779" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-histogram-distribution</span></span>
<span id="cb26-780"><a href="#cb26-780" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Data Distribution of the four Municipalities"</span></span>
<span id="cb26-781"><a href="#cb26-781" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-subcap: </span></span>
<span id="cb26-782"><a href="#cb26-782" aria-hidden="true" tabindex="-1"></a><span class="co">#| -  "Distribution of Pojo"</span></span>
<span id="cb26-783"><a href="#cb26-783" aria-hidden="true" tabindex="-1"></a><span class="co">#| -  "Distribution of Pasorapa"</span></span>
<span id="cb26-784"><a href="#cb26-784" aria-hidden="true" tabindex="-1"></a><span class="co">#| -  "Distribution of Aiquile"</span></span>
<span id="cb26-785"><a href="#cb26-785" aria-hidden="true" tabindex="-1"></a><span class="co">#| -  "Distribution of Totora"</span></span>
<span id="cb26-786"><a href="#cb26-786" aria-hidden="true" tabindex="-1"></a><span class="co">#| layout-nrow: 2</span></span>
<span id="cb26-787"><a href="#cb26-787" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-788"><a href="#cb26-788" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the municipalities</span></span>
<span id="cb26-789"><a href="#cb26-789" aria-hidden="true" tabindex="-1"></a>municipalities <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"pojo"</span>, <span class="st">"pasorapa"</span>, <span class="st">"aiquile"</span>, <span class="st">"totora"</span>)</span>
<span id="cb26-790"><a href="#cb26-790" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-791"><a href="#cb26-791" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the number of breaks (bins)</span></span>
<span id="cb26-792"><a href="#cb26-792" aria-hidden="true" tabindex="-1"></a>num_breaks <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb26-793"><a href="#cb26-793" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-794"><a href="#cb26-794" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize an empty list to store numeric breaks for each municipality</span></span>
<span id="cb26-795"><a href="#cb26-795" aria-hidden="true" tabindex="-1"></a>numeric_breaks_list <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb26-796"><a href="#cb26-796" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-797"><a href="#cb26-797" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop over each municipality</span></span>
<span id="cb26-798"><a href="#cb26-798" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (municipality <span class="cf">in</span> municipalities) {</span>
<span id="cb26-799"><a href="#cb26-799" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get the final raster data for the current municipality</span></span>
<span id="cb26-800"><a href="#cb26-800" aria-hidden="true" tabindex="-1"></a>  final_raster <span class="ot">&lt;-</span> <span class="cf">switch</span>(municipality,</span>
<span id="cb26-801"><a href="#cb26-801" aria-hidden="true" tabindex="-1"></a>                         <span class="at">pojo =</span> final_raster_pojo,</span>
<span id="cb26-802"><a href="#cb26-802" aria-hidden="true" tabindex="-1"></a>                         <span class="at">pasorapa =</span> final_raster_pasorapa,</span>
<span id="cb26-803"><a href="#cb26-803" aria-hidden="true" tabindex="-1"></a>                         <span class="at">aiquile =</span> final_raster_aiquile,</span>
<span id="cb26-804"><a href="#cb26-804" aria-hidden="true" tabindex="-1"></a>                         <span class="at">totora =</span> final_raster_totora)</span>
<span id="cb26-805"><a href="#cb26-805" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb26-806"><a href="#cb26-806" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Compute the break values</span></span>
<span id="cb26-807"><a href="#cb26-807" aria-hidden="true" tabindex="-1"></a>    break_values <span class="ot">&lt;-</span> <span class="fu">quantile</span>(<span class="fu">values</span>(final_raster, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">probs =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">length.out =</span> num_breaks <span class="sc">+</span> <span class="dv">1</span>))</span>
<span id="cb26-808"><a href="#cb26-808" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb26-809"><a href="#cb26-809" aria-hidden="true" tabindex="-1"></a><span class="co"># Store the numeric breaks in the list</span></span>
<span id="cb26-810"><a href="#cb26-810" aria-hidden="true" tabindex="-1"></a>  numeric_breaks_list[[municipality]] <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(break_values))</span>
<span id="cb26-811"><a href="#cb26-811" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb26-812"><a href="#cb26-812" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Capitalize the first letter of the municipality name</span></span>
<span id="cb26-813"><a href="#cb26-813" aria-hidden="true" tabindex="-1"></a>    capitalized_municipality <span class="ot">&lt;-</span> <span class="fu">str_to_title</span>(municipality)</span>
<span id="cb26-814"><a href="#cb26-814" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb26-815"><a href="#cb26-815" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create the histogram with equal-frequency breaks</span></span>
<span id="cb26-816"><a href="#cb26-816" aria-hidden="true" tabindex="-1"></a>  <span class="fu">hist</span>(<span class="fu">values</span>(final_raster), <span class="at">breaks =</span> <span class="st">"FD"</span>, <span class="at">main =</span> <span class="fu">paste</span>(<span class="st">"Histogram of Flood Risk for"</span>, capitalized_municipality), <span class="at">xlab =</span> <span class="st">"Flood Risk Values"</span>, <span class="at">col =</span> <span class="st">"skyblue"</span>, <span class="at">border =</span> <span class="st">"black"</span>, <span class="at">plot =</span> <span class="cn">TRUE</span>)</span>
<span id="cb26-817"><a href="#cb26-817" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb26-818"><a href="#cb26-818" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add vertical lines to represent the breaks</span></span>
<span id="cb26-819"><a href="#cb26-819" aria-hidden="true" tabindex="-1"></a>    <span class="fu">abline</span>(<span class="at">v =</span> break_values, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb26-820"><a href="#cb26-820" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb26-821"><a href="#cb26-821" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-822"><a href="#cb26-822" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-823"><a href="#cb26-823" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-826"><a href="#cb26-826" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb26-827"><a href="#cb26-827" aria-hidden="true" tabindex="-1"></a><span class="co"># Define breaks and labels for the reclassification</span></span>
<span id="cb26-828"><a href="#cb26-828" aria-hidden="true" tabindex="-1"></a>breaks_list <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb26-829"><a href="#cb26-829" aria-hidden="true" tabindex="-1"></a>  <span class="at">pojo =</span> numeric_breaks_list<span class="sc">$</span>pojo,</span>
<span id="cb26-830"><a href="#cb26-830" aria-hidden="true" tabindex="-1"></a>  <span class="at">pasorapa =</span> numeric_breaks_list<span class="sc">$</span>pasorapa,</span>
<span id="cb26-831"><a href="#cb26-831" aria-hidden="true" tabindex="-1"></a>  <span class="at">aiquile =</span> numeric_breaks_list<span class="sc">$</span>aiquile,</span>
<span id="cb26-832"><a href="#cb26-832" aria-hidden="true" tabindex="-1"></a>  <span class="at">totora =</span> numeric_breaks_list<span class="sc">$</span>totora</span>
<span id="cb26-833"><a href="#cb26-833" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb26-834"><a href="#cb26-834" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-835"><a href="#cb26-835" aria-hidden="true" tabindex="-1"></a>labels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Muy bajo"</span>, <span class="st">"Bajo"</span>, <span class="st">"Moderado"</span>, <span class="st">"Alto"</span>, <span class="st">"Muy alto"</span>)</span>
<span id="cb26-836"><a href="#cb26-836" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-837"><a href="#cb26-837" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize an empty list to store categorized rasters for each municipality</span></span>
<span id="cb26-838"><a href="#cb26-838" aria-hidden="true" tabindex="-1"></a>categorized_rasters <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb26-839"><a href="#cb26-839" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-840"><a href="#cb26-840" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop over each municipality</span></span>
<span id="cb26-841"><a href="#cb26-841" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (municipality <span class="cf">in</span> municipalities) {</span>
<span id="cb26-842"><a href="#cb26-842" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get the final raster data for the current municipality</span></span>
<span id="cb26-843"><a href="#cb26-843" aria-hidden="true" tabindex="-1"></a>  final_raster <span class="ot">&lt;-</span> <span class="cf">switch</span>(municipality,</span>
<span id="cb26-844"><a href="#cb26-844" aria-hidden="true" tabindex="-1"></a>                         <span class="at">pojo =</span> final_raster_pojo,</span>
<span id="cb26-845"><a href="#cb26-845" aria-hidden="true" tabindex="-1"></a>                         <span class="at">pasorapa =</span> final_raster_pasorapa,</span>
<span id="cb26-846"><a href="#cb26-846" aria-hidden="true" tabindex="-1"></a>                         <span class="at">aiquile =</span> final_raster_aiquile,</span>
<span id="cb26-847"><a href="#cb26-847" aria-hidden="true" tabindex="-1"></a>                         <span class="at">totora =</span> final_raster_totora)</span>
<span id="cb26-848"><a href="#cb26-848" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-849"><a href="#cb26-849" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Define breaks for the current municipality</span></span>
<span id="cb26-850"><a href="#cb26-850" aria-hidden="true" tabindex="-1"></a>  breaks <span class="ot">&lt;-</span> breaks_list[[municipality]]</span>
<span id="cb26-851"><a href="#cb26-851" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-852"><a href="#cb26-852" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Cut the raster values into categorical factors</span></span>
<span id="cb26-853"><a href="#cb26-853" aria-hidden="true" tabindex="-1"></a>  factor_raster <span class="ot">&lt;-</span> <span class="fu">cut</span>(<span class="fu">values</span>(final_raster), <span class="at">breaks =</span> breaks, <span class="at">labels =</span> labels, <span class="at">include.lowest =</span> <span class="cn">TRUE</span>)</span>
<span id="cb26-854"><a href="#cb26-854" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-855"><a href="#cb26-855" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Change the name of the raster</span></span>
<span id="cb26-856"><a href="#cb26-856" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(final_raster) <span class="ot">&lt;-</span> <span class="st">"Flood Risk"</span></span>
<span id="cb26-857"><a href="#cb26-857" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-858"><a href="#cb26-858" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create a new raster with categorized values</span></span>
<span id="cb26-859"><a href="#cb26-859" aria-hidden="true" tabindex="-1"></a>  r_categorized <span class="ot">&lt;-</span> final_raster</span>
<span id="cb26-860"><a href="#cb26-860" aria-hidden="true" tabindex="-1"></a>  <span class="fu">values</span>(r_categorized) <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(factor_raster)</span>
<span id="cb26-861"><a href="#cb26-861" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-862"><a href="#cb26-862" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Store the categorized raster in the list</span></span>
<span id="cb26-863"><a href="#cb26-863" aria-hidden="true" tabindex="-1"></a>  categorized_rasters[[municipality]] <span class="ot">&lt;-</span> r_categorized</span>
<span id="cb26-864"><a href="#cb26-864" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb26-865"><a href="#cb26-865" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-866"><a href="#cb26-866" aria-hidden="true" tabindex="-1"></a><span class="co"># Access categorized raster for a specific municipality</span></span>
<span id="cb26-867"><a href="#cb26-867" aria-hidden="true" tabindex="-1"></a><span class="co"># categorized_rasters$pasorapa</span></span>
<span id="cb26-868"><a href="#cb26-868" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-869"><a href="#cb26-869" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-872"><a href="#cb26-872" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb26-873"><a href="#cb26-873" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-all-results-flood</span></span>
<span id="cb26-874"><a href="#cb26-874" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Result Flood Risk for each Municipality"</span></span>
<span id="cb26-875"><a href="#cb26-875" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 5</span></span>
<span id="cb26-876"><a href="#cb26-876" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 5</span></span>
<span id="cb26-877"><a href="#cb26-877" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-878"><a href="#cb26-878" aria-hidden="true" tabindex="-1"></a><span class="co"># change name</span></span>
<span id="cb26-879"><a href="#cb26-879" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(categorized_rasters<span class="sc">$</span>pojo) <span class="ot">&lt;-</span> <span class="st">"Flood Risk"</span></span>
<span id="cb26-880"><a href="#cb26-880" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-881"><a href="#cb26-881" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(all_municipalities) <span class="sc">+</span></span>
<span id="cb26-882"><a href="#cb26-882" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>() <span class="sc">+</span></span>
<span id="cb26-883"><a href="#cb26-883" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(categorized_rasters<span class="sc">$</span>pojo) <span class="sc">+</span></span>
<span id="cb26-884"><a href="#cb26-884" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_raster</span>(<span class="at">palette =</span> colors) <span class="sc">+</span>  </span>
<span id="cb26-885"><a href="#cb26-885" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(categorized_rasters<span class="sc">$</span>pasorapa) <span class="sc">+</span></span>
<span id="cb26-886"><a href="#cb26-886" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_raster</span>(<span class="at">legend.show =</span> <span class="cn">FALSE</span>, <span class="at">palette =</span> colors) <span class="sc">+</span>  </span>
<span id="cb26-887"><a href="#cb26-887" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(categorized_rasters<span class="sc">$</span>aiquile) <span class="sc">+</span></span>
<span id="cb26-888"><a href="#cb26-888" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_raster</span>(<span class="at">legend.show =</span> <span class="cn">FALSE</span>, <span class="at">palette =</span> colors) <span class="sc">+</span>  </span>
<span id="cb26-889"><a href="#cb26-889" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(categorized_rasters<span class="sc">$</span>totora) <span class="sc">+</span></span>
<span id="cb26-890"><a href="#cb26-890" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_raster</span>(<span class="at">legend.show =</span> <span class="cn">FALSE</span>, <span class="at">palette =</span> colors) <span class="sc">+</span>  </span>
<span id="cb26-891"><a href="#cb26-891" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(all_municipalities) <span class="sc">+</span></span>
<span id="cb26-892"><a href="#cb26-892" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tm_borders</span>(<span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb26-893"><a href="#cb26-893" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tm_layout</span>(<span class="at">frame =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb26-894"><a href="#cb26-894" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_text</span>(<span class="st">"NAME_3"</span>, <span class="at">size =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb26-895"><a href="#cb26-895" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tm_scale_bar</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">10</span>), <span class="at">text.size =</span> <span class="fl">0.9</span>, <span class="at">position =</span> <span class="fu">c</span>(<span class="st">"left"</span>)) <span class="sc">+</span>  </span>
<span id="cb26-896"><a href="#cb26-896" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_compass</span>(<span class="at">type =</span> <span class="st">"4star"</span>, <span class="at">size =</span> <span class="dv">6</span>, <span class="at">position =</span> <span class="fu">c</span>(<span class="st">"right"</span>, <span class="st">"top"</span>)) <span class="sc">+</span></span>
<span id="cb26-897"><a href="#cb26-897" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_credits</span>(<span class="st">"Author: Johannes Quente"</span>, <span class="at">fontface =</span> <span class="st">"italic"</span>, <span class="at">align =</span> <span class="st">"right"</span>) <span class="sc">+</span></span>
<span id="cb26-898"><a href="#cb26-898" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_graticules</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb26-899"><a href="#cb26-899" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(</span>
<span id="cb26-900"><a href="#cb26-900" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text.size =</span> <span class="dv">1</span>,</span>
<span id="cb26-901"><a href="#cb26-901" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="st">"left"</span>, <span class="st">"bottom"</span>),</span>
<span id="cb26-902"><a href="#cb26-902" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.outside =</span> <span class="cn">TRUE</span></span>
<span id="cb26-903"><a href="#cb26-903" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb26-904"><a href="#cb26-904" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>